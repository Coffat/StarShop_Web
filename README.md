# ğŸŒ¸ StarShop â€“ Há»‡ thá»‘ng Quáº£n lÃ½ Cá»­a hÃ ng Hoa trá»±c tuyáº¿n

> **Ná»n táº£ng thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­ toÃ n diá»‡n** cho cá»­a hÃ ng hoa vá»›i Ä‘áº§y Ä‘á»§ tÃ­nh nÄƒng quáº£n lÃ½ vÃ  bÃ¡n hÃ ng chuyÃªn nghiá»‡p. TÃ­ch há»£p thanh toÃ¡n MoMo, váº­n chuyá»ƒn GHN, OAuth2, chat realtime vá»›i AI Assistant (Gemini), vÃ  há»‡ thá»‘ng quáº£n trá»‹ Ä‘a cáº¥p Ä‘á»™ (Admin/Staff/Customer).

---

## NhÃ³m thá»±c hiá»‡n
- VÅ© ToÃ n Tháº¯ng
- Nguyá»…n Nháº­t Huy
- Äáº·ng Ngá»c TÃ i
- Phan Quá»‘c Viá»…n

---

## ğŸ“Š CÃ´ng nghá»‡ & PhiÃªn báº£n

![Java](https://img.shields.io/badge/Java-17-ED8B00?style=for-the-badge&logo=openjdk&logoColor=white)
![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.5.5-6DB33F?style=for-the-badge&logo=spring-boot&logoColor=white)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-15-316192?style=for-the-badge&logo=postgresql&logoColor=white)
![Maven](https://img.shields.io/badge/Maven-C71A36?style=for-the-badge&logo=apache-maven&logoColor=white)
![Docker](https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=docker&logoColor=white)
![Thymeleaf](https://img.shields.io/badge/Thymeleaf-005F0F?style=for-the-badge&logo=thymeleaf&logoColor=white)

---

## ğŸ“š Má»¥c lá»¥c

- [ğŸ“– Giá»›i thiá»‡u](#-giá»›i-thiá»‡u)
- [ğŸ—ï¸ Kiáº¿n trÃºc & Stack cÃ´ng nghá»‡](#ï¸-kiáº¿n-trÃºc--stack-cÃ´ng-nghá»‡)
- [âœ¨ TÃ­nh nÄƒng chÃ­nh](#-tÃ­nh-nÄƒng-chÃ­nh)
- [ğŸ“¸ áº¢nh chá»¥p mÃ n hÃ¬nh](#-áº£nh-chá»¥p-mÃ n-hÃ¬nh)
- [ğŸ“ Cáº¥u trÃºc thÆ° má»¥c](#-cáº¥u-trÃºc-thÆ°-má»¥c)
- [âš™ï¸ Thiáº¿t láº­p & Cháº¡y á»©ng dá»¥ng](#ï¸-thiáº¿t-láº­p--cháº¡y-á»©ng-dá»¥ng)
  - [YÃªu cáº§u há»‡ thá»‘ng](#yÃªu-cáº§u-há»‡-thá»‘ng)
  - [Cháº¡y báº±ng Docker](#cháº¡y-báº±ng-docker)
  - [Cháº¡y Development](#cháº¡y-development)
  - [Cáº¥u hÃ¬nh mÃ´i trÆ°á»ng](#cáº¥u-hÃ¬nh-mÃ´i-trÆ°á»ng)
- [ğŸ”Œ TÃ­ch há»£p bÃªn ngoÃ i](#-tÃ­ch-há»£p-bÃªn-ngoÃ i)
  - [GHN - Váº­n chuyá»ƒn](#ghn---váº­n-chuyá»ƒn)
  - [MoMo - Thanh toÃ¡n](#momo---thanh-toÃ¡n)
  - [Gemini AI - Chatbot](#gemini-ai---chatbot)
- [ğŸ“ TÃ i liá»‡u API](#-tÃ i-liá»‡u-api)
- [ğŸ”’ Báº£o máº­t & Triá»ƒn khai](#-báº£o-máº­t--triá»ƒn-khai)
- [ğŸ”§ Kháº¯c phá»¥c sá»± cá»‘](#-kháº¯c-phá»¥c-sá»±-cá»‘)
- [ğŸ“„ Giáº¥y phÃ©p](#-giáº¥y-phÃ©p)

---

## ğŸ“– Giá»›i thiá»‡u

**StarShop** lÃ  há»‡ thá»‘ng quáº£n lÃ½ vÃ  bÃ¡n hÃ ng trá»±c tuyáº¿n toÃ n diá»‡n dÃ nh cho cá»­a hÃ ng hoa, Ä‘Æ°á»£c xÃ¢y dá»±ng trÃªn ná»n táº£ng Spring Boot vá»›i kiáº¿n trÃºc MVC hiá»‡n Ä‘áº¡i.

### ğŸ¯ Má»¥c tiÃªu dá»± Ã¡n
- **Tráº£i nghiá»‡m khÃ¡ch hÃ ng tá»‘i Æ°u**: Giao diá»‡n thÃ¢n thiá»‡n, quy trÃ¬nh Ä‘áº·t hÃ ng nhanh chÃ³ng
- **Quáº£n trá»‹ hiá»‡u quáº£**: Dashboard phÃ¢n quyá»n rÃµ rÃ ng cho Admin/Staff vá»›i analytics chi tiáº¿t
- **TÃ­ch há»£p dá»‹ch vá»¥ Viá»‡t Nam**: GHN (váº­n chuyá»ƒn), MoMo (thanh toÃ¡n)
- **Há»— trá»£ thÃ´ng minh**: Chat realtime vá»›i AI Assistant (Google Gemini)
- **Báº£o máº­t cao**: OAuth2, JWT, Spring Security vá»›i role-based access control

---

## ğŸ—ï¸ Kiáº¿n trÃºc & Stack cÃ´ng nghá»‡

### Backend Framework
- **Spring Boot 3.5.5** - Framework chÃ­nh
- **Spring MVC** - Web layer vá»›i pattern Controller-Service-Repository
- **Spring Data JPA** - ORM vÃ  database access
- **Spring Security** - Authentication & Authorization
- **Spring WebSocket** - Real-time communication
- **Server-Sent Events (SSE)** - Real-time updates

### Frontend & View
- **Thymeleaf** - Server-side template engine
- **Bootstrap 5** - Responsive UI framework
- **JavaScript/jQuery** - Client-side interactions
- **SockJS + STOMP** - WebSocket client

### Database
- **PostgreSQL 15** - Relational database
- **Docker Compose** - Database containerization
- **Flyway/SQL Scripts** - Schema initialization (`docker/init/*.sql`)

### Security & Authentication
- **Spring Security** - Core security framework
- **OAuth2 Client** - Google & Facebook login
- **JWT (JJWT 0.12.6)** - API authentication
- **BCrypt** - Password encryption

### External Integrations
- **Google Gemini AI** - AI chatbot assistant (gemini-2.5-flash)
- **MoMo Payment Gateway** - Online payment (test environment)
- **GHN API** - Shipping fee calculation & address management
- **SMTP** - Email notifications

### Documentation & Monitoring
- **Swagger/OpenAPI 3** - API documentation (springdoc 2.8.4)
- **Spring Boot Actuator** - Health checks & metrics
- **Logging** - SLF4J/Logback

### Build & Development Tools
- **Maven** - Dependency management & build tool
- **Lombok** - Reduce boilerplate code
- **Spring DevTools** - Hot reload for development
- **Apache POI** - Excel export functionality

### Package Structure
```
com.example.demo/
â”œâ”€â”€ client/          # External API clients (GHN, Gemini)
â”œâ”€â”€ config/          # Configuration classes
â”‚   â”œâ”€â”€ SecurityConfig
â”‚   â”œâ”€â”€ WebSocketConfig
â”‚   â”œâ”€â”€ SwaggerConfig
â”‚   â””â”€â”€ Properties classes (MoMo, GHN, Gemini)
â”œâ”€â”€ controller/      # REST & MVC controllers
â”‚   â”œâ”€â”€ admin/      # Admin dashboard controllers
â”‚   â”œâ”€â”€ staff/      # Staff dashboard controllers
â”‚   â””â”€â”€ api/        # REST API endpoints
â”œâ”€â”€ dto/            # Data Transfer Objects
â”œâ”€â”€ entity/         # JPA entities
â”œâ”€â”€ repository/     # Spring Data repositories
â”œâ”€â”€ service/        # Business logic layer
â”œâ”€â”€ security/       # JWT filters & security utilities
â”œâ”€â”€ scheduler/      # Scheduled tasks (payroll, etc.)
â””â”€â”€ util/           # Helper utilities
```

---

## âœ¨ TÃ­nh nÄƒng chÃ­nh

### ğŸ” XÃ¡c thá»±c & Báº£o máº­t
- **ÄÄƒng nháº­p/ÄÄƒng kÃ½** vá»›i email & password
- **OAuth2 Login** - Google vÃ  Facebook
- **JWT Authentication** cho REST API
- **QuÃªn máº­t kháº©u** vá»›i OTP qua email
- **Role-based Access Control** - 3 vai trÃ²: CUSTOMER, STAFF, ADMIN
- **Session Management** - Báº£o máº­t phiÃªn lÃ m viá»‡c

### ğŸ“¦ Quáº£n lÃ½ Sáº£n pháº©m & Danh má»¥c
- **CRUD Ä‘áº§y Ä‘á»§** - ThÃªm, sá»­a, xÃ³a sáº£n pháº©m vÃ  danh má»¥c
- **Upload hÃ¬nh áº£nh** - Há»— trá»£ nhiá»u áº£nh cho má»—i sáº£n pháº©m
- **TÃ¬m kiáº¿m & Lá»c** - TÃ¬m kiáº¿m theo tÃªn, giÃ¡, danh má»¥c
- **ÄÃ¡nh giÃ¡ & Review** - Há»‡ thá»‘ng Ä‘Ã¡nh giÃ¡ vá»›i AI sentiment analysis
- **Wishlist** - Danh sÃ¡ch yÃªu thÃ­ch cá»§a khÃ¡ch hÃ ng
- **AI Product Description** - Tá»± Ä‘á»™ng táº¡o mÃ´ táº£ sáº£n pháº©m báº±ng AI
- **Quáº£n lÃ½ tá»“n kho** - Theo dÃµi sá»‘ lÆ°á»£ng sáº£n pháº©m

### ğŸ›’ Giá» hÃ ng & Äáº·t hÃ ng
- **Giá» hÃ ng real-time** - Cáº­p nháº­t tá»©c thá»i
- **Checkout linh hoáº¡t** - Há»— trá»£ nhiá»u Ä‘á»‹a chá»‰ giao hÃ ng
- **Há»‡ thá»‘ng Voucher** - MÃ£ giáº£m giÃ¡ vá»›i Ä‘iá»u kiá»‡n Ã¡p dá»¥ng
- **Theo dÃµi Ä‘Æ¡n hÃ ng** - Cáº­p nháº­t tráº¡ng thÃ¡i realtime
- **Lá»‹ch sá»­ Ä‘Æ¡n hÃ ng** - Xem láº¡i cÃ¡c Ä‘Æ¡n hÃ ng Ä‘Ã£ Ä‘áº·t
- **Quáº£n lÃ½ tráº¡ng thÃ¡i** - PENDING, CONFIRMED, SHIPPING, DELIVERED, CANCELLED

### ğŸšš Váº­n chuyá»ƒn GHN
- **TÃ­ch há»£p GHN API** - Giao HÃ ng Nhanh
- **Äá»‹a chá»‰ 2-3 cáº¥p** - Tá»‰nh/Quáº­n/PhÆ°á»ng
- **TÃ­nh phÃ­ tá»± Ä‘á»™ng** - Dá»±a trÃªn khoáº£ng cÃ¡ch vÃ  trá»ng lÆ°á»£ng
- **Quáº£n lÃ½ Ä‘á»‹a chá»‰** - LÆ°u nhiá»u Ä‘á»‹a chá»‰ giao hÃ ng
- **Cache thÃ´ng minh** - Cache dá»¯ liá»‡u Ä‘á»‹a chá»‰ Ä‘á»ƒ tÄƒng tá»‘c

### ğŸ’³ Thanh toÃ¡n
- **COD** - Thanh toÃ¡n khi nháº­n hÃ ng
- **MoMo** - Cá»•ng thanh toÃ¡n trá»±c tuyáº¿n (test environment)
- **SSE Updates** - Cáº­p nháº­t tráº¡ng thÃ¡i thanh toÃ¡n realtime
- **Webhook** - Xá»­ lÃ½ callback tá»« MoMo tá»± Ä‘á»™ng
- **Báº£o máº­t** - MÃ£ hÃ³a vÃ  xÃ¡c thá»±c giao dá»‹ch

### ğŸ’¬ Chat & AI Assistant
- **WebSocket Chat** - TrÃ² chuyá»‡n realtime
- **AI Chatbot** - Google Gemini 2.5-flash
- **Tá»± Ä‘á»™ng tráº£ lá»i** - Há»— trá»£ khÃ¡ch hÃ ng 24/7
- **Handoff Queue** - Chuyá»ƒn tiáº¿p Ä‘áº¿n nhÃ¢n viÃªn khi cáº§n
- **LÆ°u lá»‹ch sá»­** - Ghi láº¡i toÃ n bá»™ cuá»™c há»™i thoáº¡i
- **PII Detection** - Báº£o vá»‡ thÃ´ng tin cÃ¡ nhÃ¢n
- **Context Awareness** - Hiá»ƒu ngá»¯ cáº£nh vÃ  lá»‹ch sá»­ chat

### ğŸ“Š Dashboard Admin

#### Analytics & BÃ¡o cÃ¡o
- **Thá»‘ng kÃª tá»•ng quan** - Doanh thu, Ä‘Æ¡n hÃ ng, khÃ¡ch hÃ ng, sáº£n pháº©m
- **Biá»ƒu Ä‘á»“ tÆ°Æ¡ng quan** - PhÃ¢n tÃ­ch 7/30/90 ngÃ y
- **Xu hÆ°á»›ng doanh thu** - Biá»ƒu Ä‘á»“ revenue trend
- **Tráº¡ng thÃ¡i Ä‘Æ¡n hÃ ng** - PhÃ¢n bá»‘ theo tráº¡ng thÃ¡i
- **AI Insights** - Gá»£i Ã½ vÃ  khuyáº¿n nghá»‹ tá»± Ä‘á»™ng
- **Export Excel** - Xuáº¥t bÃ¡o cÃ¡o chi tiáº¿t

#### Quáº£n lÃ½ Kinh doanh
- **ÄÆ¡n hÃ ng** - CRUD, tÃ¬m kiáº¿m, lá»c, cáº­p nháº­t tráº¡ng thÃ¡i
- **Sáº£n pháº©m** - CRUD, upload áº£nh, quáº£n lÃ½ tá»“n kho, AI description
- **Danh má»¥c** - CRUD catalogs vÃ  quáº£n lÃ½ hÃ¬nh áº£nh
- **Voucher** - Táº¡o mÃ£ giáº£m giÃ¡ (PERCENTAGE/FIXED) vá»›i AI suggestions
- **ÄÃ¡nh giÃ¡** - Quáº£n lÃ½ reviews, AI sentiment analysis, pháº£n há»“i

#### Quáº£n lÃ½ KhÃ¡ch hÃ ng
- **Danh sÃ¡ch khÃ¡ch hÃ ng** - Xem, tÃ¬m kiáº¿m, lá»c
- **PhÃ¢n khÃºc tá»± Ä‘á»™ng** - VIP, NEW, AT_RISK (AI-powered)
- **Äá»‹a chá»‰ giao hÃ ng** - Quáº£n lÃ½ nhiá»u Ä‘á»‹a chá»‰
- **Lá»‹ch sá»­ mua hÃ ng** - Theo dÃµi hoáº¡t Ä‘á»™ng khÃ¡ch hÃ ng

#### Quáº£n lÃ½ NhÃ¢n sá»±
- **NhÃ¢n viÃªn** - CRUD, mÃ£ NV, chá»©c vá»¥, phÃ²ng ban, lÆ°Æ¡ng/giá»
- **Cháº¥m cÃ´ng** - Timesheet check-in/out, tá»•ng há»£p theo thÃ¡ng
- **TÃ­nh lÆ°Æ¡ng** - Tá»± Ä‘á»™ng tÃ­nh lÆ°Æ¡ng (PENDING/PAID/OVERDUE)
- **Scheduler** - Tá»± Ä‘á»™ng tÃ­nh lÆ°Æ¡ng cuá»‘i thÃ¡ng

#### Marketing & Ná»™i dung
- **Chiáº¿n dá»‹ch Marketing** - Táº¡o campaign, gá»­i email hÃ ng loáº¡t
- **Segmentation** - Targeting theo nhÃ³m khÃ¡ch hÃ ng
- **Email Templates** - Quáº£n lÃ½ máº«u email
- **Content Management** - Banner, hÃ¬nh áº£nh, ná»™i dung tÄ©nh

#### Há»‡ thá»‘ng
- **CÃ i Ä‘áº·t** - Cáº¥u hÃ¬nh chung há»‡ thá»‘ng
- **Cache Management** - Quáº£n lÃ½ cache hiá»‡u quáº£
- **Health Check** - GiÃ¡m sÃ¡t tÃ¬nh tráº¡ng há»‡ thá»‘ng

### ğŸ’¼ Dashboard Staff

- **Xá»­ lÃ½ ÄÆ¡n hÃ ng** - Quáº£n lÃ½ Ä‘Æ¡n hÃ ng Ä‘Æ°á»£c assigned
- **Chat Realtime** - Há»— trá»£ khÃ¡ch hÃ ng trá»±c tiáº¿p
- **Cháº¥m cÃ´ng** - Check-in/check-out hÃ ng ngÃ y
- **Báº£ng lÆ°Æ¡ng** - Xem lÆ°Æ¡ng vÃ  thÆ°á»Ÿng cÃ¡ nhÃ¢n
- **Quáº£n lÃ½ Review** - Pháº£n há»“i Ä‘Ã¡nh giÃ¡ khÃ¡ch hÃ ng
- **Hiá»‡u suáº¥t** - Theo dÃµi KPI cÃ¡ nhÃ¢n

### ğŸ”§ TÃ­nh nÄƒng bá»• sung

- **Email Notifications** - Gá»­i thÃ´ng bÃ¡o qua SMTP
- **Export Excel** - Xuáº¥t dá»¯ liá»‡u ra Excel (Apache POI)
- **API Documentation** - Swagger/OpenAPI 3.0
- **Rate Limiting** - Giá»›i háº¡n tá»‘c Ä‘á»™ request
- **Intelligent Caching** - Cache Ä‘á»‹a chá»‰, phÃ­ ship, gá»£i Ã½ sáº£n pháº©m
- **Salary Scheduler** - Tá»± Ä‘á»™ng tÃ­nh lÆ°Æ¡ng theo giá»
- **Customer Segmentation** - AI phÃ¢n loáº¡i khÃ¡ch hÃ ng (VIP/NEW/AT_RISK)
- **AI Monitoring** - GiÃ¡m sÃ¡t vÃ  phÃ¢n tÃ­ch thÃ´ng minh
- **Session Management** - Quáº£n lÃ½ phiÃªn an toÃ n
- **Health Checks** - Spring Boot Actuator monitoring

---

## ğŸ“¸ áº¢nh chá»¥p mÃ n hÃ¬nh

> CÃ¡c giao diá»‡n chÃ­nh cá»§a há»‡ thá»‘ng StarShop

### Giao diá»‡n KhÃ¡ch hÃ ng

| Trang chá»§ | Sáº£n pháº©m |
|:---:|:---:|
| ![Trang chá»§](assets/home.png) | ![Trang sáº£n pháº©m](assets/products.png) |

| ÄÄƒng nháº­p | Há»“ sÆ¡ |
|:---:|:---:|
| ![ÄÄƒng nháº­p](assets/login.png) | ![Há»“ sÆ¡ tÃ i khoáº£n](assets/profile.png) |

| Giá» hÃ ng | API Docs |
|:---:|:---:|
| ![Giá» hÃ ng](assets/cart.png) | ![Swagger UI](assets/swagger.png) |

> **LÆ°u Ã½**: Äá»ƒ xem Ä‘áº§y Ä‘á»§ cÃ¡c giao diá»‡n Admin vÃ  Staff, vui lÃ²ng cháº¡y á»©ng dá»¥ng vÃ  truy cáº­p vá»›i quyá»n tÆ°Æ¡ng á»©ng.


---

## ğŸ“ Cáº¥u trÃºc thÆ° má»¥c

```text
demo_web/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/com/example/demo/
â”‚   â”‚   â”‚   â”œâ”€â”€ client/              # External API clients
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ GhnClient.java   # Giao HÃ ng Nhanh API
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ GeminiClient.java # Google Gemini AI
â”‚   â”‚   â”‚   â”œâ”€â”€ config/              # Configuration classes
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SecurityConfig.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WebSocketConfig.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ SwaggerConfig.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ *Properties.java  # MoMo, GHN, Gemini configs
â”‚   â”‚   â”‚   â”œâ”€â”€ controller/          # MVC & REST controllers
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ admin/          # Admin dashboard
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ staff/          # Staff dashboard
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ api/            # REST API endpoints
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...             # Auth, Payment, Shipping, Chat
â”‚   â”‚   â”‚   â”œâ”€â”€ dto/                 # Data Transfer Objects
â”‚   â”‚   â”‚   â”œâ”€â”€ entity/              # JPA Entities
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ User.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Product.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Order.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Conversation.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”‚   â”œâ”€â”€ repository/          # Spring Data JPA
â”‚   â”‚   â”‚   â”œâ”€â”€ service/             # Business logic
â”‚   â”‚   â”‚   â”œâ”€â”€ security/            # JWT & Security
â”‚   â”‚   â”‚   â”œâ”€â”€ scheduler/           # Scheduled tasks
â”‚   â”‚   â”‚   â””â”€â”€ util/                # Helper utilities
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â”œâ”€â”€ application.yml      # Main config
â”‚   â”‚       â”œâ”€â”€ application-dev.properties
â”‚   â”‚       â”œâ”€â”€ application-prod.properties
â”‚   â”‚       â”œâ”€â”€ templates/           # Thymeleaf templates
â”‚   â”‚       â”‚   â”œâ”€â”€ admin/          # Admin views
â”‚   â”‚       â”‚   â”œâ”€â”€ staff/          # Staff views
â”‚   â”‚       â”‚   â”œâ”€â”€ customer/       # Customer views
â”‚   â”‚       â”‚   â””â”€â”€ layouts/        # Shared layouts
â”‚   â”‚       â””â”€â”€ static/              # Static assets
â”‚   â”‚           â”œâ”€â”€ css/
â”‚   â”‚           â”œâ”€â”€ js/
â”‚   â”‚           â””â”€â”€ images/
â”‚   â””â”€â”€ test/                    # Unit & Integration tests
â”œâ”€â”€ docker/
â”‚   â””â”€â”€ init/                    # Database initialization
â”‚       â”œâ”€â”€ 01-schema.sql
â”‚       â”œâ”€â”€ 02-data.sql
â”‚       â””â”€â”€ ...
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ GHN_INTEGRATION.md       # GHN integration guide
â”œâ”€â”€ assets/                      # Screenshots
â”œâ”€â”€ docker-compose.yml           # PostgreSQL container
â”œâ”€â”€ pom.xml                      # Maven dependencies
â”œâ”€â”€ mvnw, mvnw.cmd               # Maven wrapper
â”œâ”€â”€ .env.example                 # Environment variables template
â””â”€â”€ README.md                    # This file
```

---

## âš™ï¸ Thiáº¿t láº­p & Cháº¡y á»©ng dá»¥ng

### YÃªu cáº§u há»‡ thá»‘ng

- **Java Development Kit (JDK)** - Version 17 trá»Ÿ lÃªn
- **Docker & Docker Compose** - Äá»ƒ cháº¡y PostgreSQL
- **Maven** - ÄÃ£ cÃ³ sáºµn Maven Wrapper (`mvnw`)
- **VS Code Dev Tunnels** - (TÃ¹y chá»n) Äá»ƒ test MoMo callback
- **Git** - Version control

### Cháº¡y báº±ng Docker

#### 1. Khá»Ÿi Ä‘á»™ng PostgreSQL

```bash
# Clone repository
git clone <repository-url>
cd demo_web

# Khá»Ÿi Ä‘á»™ng PostgreSQL container
docker compose up -d
```

**ThÃ´ng tin káº¿t ná»‘i Database:**
- **URL**: `jdbc:postgresql://localhost:5432/flower_shop_system`
- **Username**: `flower_admin`
- **Password**: `flower_password_2024`
- **Port**: `5432`

> Database sáº½ tá»± Ä‘á»™ng khá»Ÿi táº¡o schema vÃ  seed data tá»« `docker/init/*.sql`

#### 2. Kiá»ƒm tra Database

```bash
# Kiá»ƒm tra container Ä‘ang cháº¡y
docker compose ps

# Xem logs
docker compose logs -f
```

### Cháº¡y Development

#### PhÆ°Æ¡ng Ã¡n 1: Sá»­ dá»¥ng Maven Wrapper (Khuyáº¿n nghá»‹)

```bash
# Windows
.\mvnw.cmd spring-boot:run

# Linux/Mac
./mvnw spring-boot:run
```

#### PhÆ°Æ¡ng Ã¡n 2: Sá»­ dá»¥ng script dev

```bash
# Thiáº¿t láº­p VS Code Dev Tunnel (cho MoMo callback)
./dev-vscode.sh set-url
# Nháº­p URL: https://your-tunnel-url.app.github.dev

# Cháº¡y á»©ng dá»¥ng
./dev-vscode.sh start
```

#### PhÆ°Æ¡ng Ã¡n 3: Cháº¡y tá»« IDE

1. Import project vÃ o IDE (IntelliJ IDEA, Eclipse, VS Code)
2. Äá»£i Maven download dependencies
3. Cháº¡y class `DemoApplication.java`

### Truy cáº­p á»©ng dá»¥ng

- **Trang chá»§**: http://localhost:8080
- **Swagger UI**: http://localhost:8080/swagger-ui.html
- **API Docs**: http://localhost:8080/v3/api-docs
- **Actuator**: http://localhost:8080/actuator

### TÃ i khoáº£n máº·c Ä‘á»‹nh

| Vai trÃ² | Email | Password |
|---------|-------|----------|
| Admin | admin@starshop.com | admin123 |
| Staff | staff@starshop.com | staff123 |
| Customer | customer@starshop.com | customer123 |

> **LÆ°u Ã½**: Äá»•i máº­t kháº©u ngay sau láº§n Ä‘Äƒng nháº­p Ä‘áº§u tiÃªn trong mÃ´i trÆ°á»ng production!

---

### Cáº¥u hÃ¬nh mÃ´i trÆ°á»ng

#### 1. Copy file cáº¥u hÃ¬nh máº«u

```bash
cp .env.example .env
```

#### 2. Cáº¥u hÃ¬nh cÃ¡c biáº¿n mÃ´i trÆ°á»ng

Chá»‰nh sá»­a file `.env` hoáº·c export trá»±c tiáº¿p:

```bash
# Database Configuration
export SPRING_DATASOURCE_URL=jdbc:postgresql://localhost:5432/flower_shop_system
export SPRING_DATASOURCE_USERNAME=flower_admin
export SPRING_DATASOURCE_PASSWORD=flower_password_2024

# GHN (Giao HÃ ng Nhanh) Configuration
export GHN_TOKEN=your_ghn_token_here
export GHN_SHOP_ID=your_shop_id
export GHN_FROM_PROVINCE_ID=202
export GHN_FROM_DISTRICT_ID=3695
export GHN_FROM_WARD_CODE=90745

# MoMo Payment Configuration
export MOMO_PARTNER_CODE=your_partner_code
export MOMO_ACCESS_KEY=your_access_key
export MOMO_SECRET_KEY=your_secret_key
export VSCODE_FORWARD_URL=https://your-tunnel-url.example

# Google Gemini AI Configuration
export GEMINI_API_KEY=your_gemini_api_key
export GEMINI_MODEL=gemini-2.5-flash

# OAuth2 Configuration
export SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GOOGLE_CLIENT_ID=your_google_client_id
export SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_GOOGLE_CLIENT_SECRET=your_google_client_secret
export SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_FACEBOOK_CLIENT_ID=your_facebook_client_id
export SPRING_SECURITY_OAUTH2_CLIENT_REGISTRATION_FACEBOOK_CLIENT_SECRET=your_facebook_client_secret

# SMTP Email Configuration
export SPRING_MAIL_HOST=smtp.gmail.com
export SPRING_MAIL_PORT=587
export SPRING_MAIL_USERNAME=your_email@gmail.com
export SPRING_MAIL_PASSWORD=your_app_password

# JWT Configuration
export JWT_SECRET=your_jwt_secret_key_here_minimum_256_bits
export JWT_EXPIRATION=86400000
```

#### 3. Profiles

á»¨ng dá»¥ng há»— trá»£ nhiá»u profiles:

- **dev** - Development (máº·c Ä‘á»‹nh)
- **prod** - Production

```bash
# Cháº¡y vá»›i profile cá»¥ thá»ƒ
./mvnw spring-boot:run -Dspring-boot.run.profiles=prod
```

---

## ğŸ”Œ TÃ­ch há»£p bÃªn ngoÃ i

### GHN - Váº­n chuyá»ƒn

#### ÄÄƒng kÃ½ tÃ i khoáº£n GHN

1. Truy cáº­p [GHN Developer](https://dev.ghn.vn/)
2. ÄÄƒng kÃ½ tÃ i khoáº£n vÃ  táº¡o shop
3. Láº¥y `Token` vÃ  `ShopID`

#### Cáº¥u hÃ¬nh

```bash
export GHN_TOKEN=your_token_here
export GHN_SHOP_ID=your_shop_id
export GHN_FROM_PROVINCE_ID=202      # HÃ  Ná»™i
export GHN_FROM_DISTRICT_ID=3695     # Quáº­n Cáº§u Giáº¥y
export GHN_FROM_WARD_CODE=90745      # PhÆ°á»ng Dá»‹ch Vá»ng
```

#### API Endpoints

- `GET /api/locations/provinces` - Láº¥y danh sÃ¡ch tá»‰nh/thÃ nh
- `GET /api/locations/districts?provinceId={id}` - Láº¥y quáº­n/huyá»‡n
- `GET /api/locations/wards?districtId={id}` - Láº¥y phÆ°á»ng/xÃ£
- `POST /api/shipping/fee` - TÃ­nh phÃ­ váº­n chuyá»ƒn

#### TÃ i liá»‡u chi tiáº¿t

Xem `docs/GHN_INTEGRATION.md` Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t vá»:
- Äá»‹a chá»‰ 2 cáº¥p vs 3 cáº¥p
- Caching strategy
- Error handling

### MoMo - Thanh toÃ¡n

#### ÄÄƒng kÃ½ MoMo Test

1. Truy cáº­p [MoMo Developer](https://developers.momo.vn/)
2. ÄÄƒng kÃ½ tÃ i khoáº£n test
3. Láº¥y `PartnerCode`, `AccessKey`, `SecretKey`

#### Cáº¥u hÃ¬nh

```bash
export MOMO_PARTNER_CODE=your_partner_code
export MOMO_ACCESS_KEY=your_access_key
export MOMO_SECRET_KEY=your_secret_key
export VSCODE_FORWARD_URL=https://your-tunnel.app.github.dev
```

#### Thiáº¿t láº­p VS Code Dev Tunnel

```bash
# CÃ i Ä‘áº·t VS Code CLI
code tunnel

# Hoáº·c sá»­ dá»¥ng script
./dev-vscode.sh set-url
```

#### API Endpoints

- `POST /payment/momo/create` - Táº¡o giao dá»‹ch
- `GET /payment/momo/return` - Return URL sau thanh toÃ¡n
- `POST /payment/momo/notify` - Webhook callback
- `GET /sse/orders/{orderId}` - SSE real-time updates

#### Test thanh toÃ¡n

1. Táº¡o Ä‘Æ¡n hÃ ng vÃ  chá»n thanh toÃ¡n MoMo
2. QuÃ©t QR code hoáº·c dÃ¹ng app MoMo test
3. Theo dÃµi tráº¡ng thÃ¡i real-time qua SSE

### Gemini AI - Chatbot

#### Láº¥y API Key

1. Truy cáº­p [Google AI Studio](https://makersuite.google.com/app/apikey)
2. Táº¡o API key má»›i
3. Copy vÃ  lÆ°u vÃ o biáº¿n mÃ´i trÆ°á»ng

#### Cáº¥u hÃ¬nh

```bash
export GEMINI_API_KEY=your_api_key_here
export GEMINI_MODEL=gemini-2.5-flash
export GEMINI_TEMPERATURE=0.5
export GEMINI_MAX_TOKENS=8192
```

#### TÃ­nh nÄƒng

- **AI Chatbot** - Tráº£ lá»i tá»± Ä‘á»™ng cÃ¢u há»i khÃ¡ch hÃ ng
- **Product Description** - Táº¡o mÃ´ táº£ sáº£n pháº©m
- **Sentiment Analysis** - PhÃ¢n tÃ­ch Ä‘Ã¡nh giÃ¡
- **Customer Segmentation** - PhÃ¢n loáº¡i khÃ¡ch hÃ ng
- **AI Insights** - Gá»£i Ã½ kinh doanh

#### WebSocket Chat

```javascript
// Káº¿t ná»‘i WebSocket
const socket = new SockJS('/ws');
const stompClient = Stomp.over(socket);

stompClient.connect({}, function(frame) {
    stompClient.subscribe('/user/queue/messages', function(message) {
        // Xá»­ lÃ½ tin nháº¯n
    });
});
```

---

## ğŸ“ TÃ i liá»‡u API

### Swagger UI

Truy cáº­p tÃ i liá»‡u API tÆ°Æ¡ng tÃ¡c táº¡i:

**URL**: http://localhost:8080/swagger-ui.html

### OpenAPI Specification

- **JSON**: http://localhost:8080/v3/api-docs
- **YAML**: http://localhost:8080/v3/api-docs.yaml

### CÃ¡c API chÃ­nh

#### Authentication
- `POST /api/auth/register` - ÄÄƒng kÃ½ tÃ i khoáº£n
- `POST /api/auth/login` - ÄÄƒng nháº­p
- `POST /api/auth/refresh` - Refresh token
- `POST /api/auth/forgot-password` - QuÃªn máº­t kháº©u

#### Products
- `GET /api/products` - Danh sÃ¡ch sáº£n pháº©m
- `GET /api/products/{id}` - Chi tiáº¿t sáº£n pháº©m
- `POST /api/products` - Táº¡o sáº£n pháº©m (Admin)
- `PUT /api/products/{id}` - Cáº­p nháº­t sáº£n pháº©m (Admin)
- `DELETE /api/products/{id}` - XÃ³a sáº£n pháº©m (Admin)

#### Orders
- `GET /api/orders` - Danh sÃ¡ch Ä‘Æ¡n hÃ ng
- `GET /api/orders/{id}` - Chi tiáº¿t Ä‘Æ¡n hÃ ng
- `POST /api/orders` - Táº¡o Ä‘Æ¡n hÃ ng
- `PUT /api/orders/{id}/status` - Cáº­p nháº­t tráº¡ng thÃ¡i

#### Cart
- `GET /api/cart` - Xem giá» hÃ ng
- `POST /api/cart/items` - ThÃªm vÃ o giá»
- `PUT /api/cart/items/{id}` - Cáº­p nháº­t sá»‘ lÆ°á»£ng
- `DELETE /api/cart/items/{id}` - XÃ³a khá»i giá»

### Authentication

API sá»­ dá»¥ng JWT Bearer token:

```bash
curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
     http://localhost:8080/api/orders
```

---

## ğŸ”’ Báº£o máº­t & Triá»ƒn khai

### Báº£o máº­t

#### 1. Quáº£n lÃ½ Secrets

**KHÃ”NG BAO GIá»** commit secrets vÃ o Git:

```bash
# Sá»­ dá»¥ng biáº¿n mÃ´i trÆ°á»ng
export SENSITIVE_KEY=value

# Hoáº·c Secret Manager (AWS, Azure, GCP)
# Hoáº·c Docker Secrets
# Hoáº·c Kubernetes Secrets
```

#### 2. HTTPS & SSL/TLS

```nginx
# Nginx reverse proxy
server {
    listen 443 ssl http2;
    server_name starshop.example.com;
    
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    
    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header X-Forwarded-Proto https;
    }
}
```

#### 3. Cookie Security

```yaml
spring:
  servlet:
    session:
      cookie:
        secure: true          # Chá»‰ gá»­i qua HTTPS
        http-only: true       # KhÃ´ng truy cáº­p tá»« JavaScript
        same-site: strict     # Chá»‘ng CSRF
```

#### 4. Rate Limiting

ÄÃ£ tÃ­ch há»£p rate limiting Ä‘á»ƒ chá»‘ng DDoS vÃ  brute force.

#### 5. SQL Injection Prevention

Sá»­ dá»¥ng JPA/Hibernate vá»›i prepared statements.

#### 6. XSS Prevention

Thymeleaf tá»± Ä‘á»™ng escape HTML.

### Triá»ƒn khai Production

#### Checklist trÆ°á»›c khi deploy

- [ ] Äá»•i táº¥t cáº£ máº­t kháº©u máº·c Ä‘á»‹nh
- [ ] Cáº¥u hÃ¬nh biáº¿n mÃ´i trÆ°á»ng production
- [ ] Báº­t HTTPS vÃ  SSL/TLS
- [ ] Táº¯t Spring DevTools
- [ ] Äáº·t log level = WARN hoáº·c ERROR
- [ ] Cáº¥u hÃ¬nh database backup tá»± Ä‘á»™ng
- [ ] Thiáº¿t láº­p monitoring vÃ  alerting
- [ ] Kiá»ƒm tra firewall rules
- [ ] Cáº¥u hÃ¬nh CORS chÃ­nh xÃ¡c
- [ ] Review Spring Security config

#### Docker Production

```dockerfile
# Dockerfile
FROM eclipse-temurin:17-jre-alpine
WORKDIR /app
COPY target/*.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
```

```bash
# Build
./mvnw clean package -DskipTests
docker build -t starshop:latest .

# Run
docker run -d \
  -p 8080:8080 \
  --env-file .env.prod \
  --name starshop \
  starshop:latest
```

#### Kubernetes Deployment

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: starshop
spec:
  replicas: 3
  selector:
    matchLabels:
      app: starshop
  template:
    metadata:
      labels:
        app: starshop
    spec:
      containers:
      - name: starshop
        image: starshop:latest
        ports:
        - containerPort: 8080
        envFrom:
        - secretRef:
            name: starshop-secrets
```

---

## ğŸ”§ Kháº¯c phá»¥c sá»± cá»‘

### Database Issues

#### Lá»—i káº¿t ná»‘i PostgreSQL

```bash
# Kiá»ƒm tra container
docker compose ps

# Kiá»ƒm tra logs
docker compose logs postgres

# Restart container
docker compose restart postgres

# Kiá»ƒm tra port
netstat -an | grep 5432
```

**NguyÃªn nhÃ¢n thÆ°á»ng gáº·p:**
- Port 5432 Ä‘Ã£ bá»‹ sá»­ dá»¥ng
- Sai thÃ´ng tin Ä‘Äƒng nháº­p
- Container chÆ°a khá»Ÿi Ä‘á»™ng xong

#### Lá»—i migration/schema

```bash
# XÃ³a vÃ  táº¡o láº¡i database
docker compose down -v
docker compose up -d
```

### GHN Integration Issues

#### 401 Unauthorized

```bash
# Kiá»ƒm tra token
echo $GHN_TOKEN

# Test API trá»±c tiáº¿p
curl -H "Token: YOUR_TOKEN" \
     https://dev-online-gateway.ghn.vn/shiip/public-api/master-data/province
```

**Giáº£i phÃ¡p:**
- Kiá»ƒm tra token cÃ²n hiá»‡u lá»±c
- Äáº£m báº£o Ä‘Ãºng `GHN_SHOP_ID`
- Kiá»ƒm tra IP whitelist (náº¿u cÃ³)

### MoMo Payment Issues

#### Webhook khÃ´ng nháº­n Ä‘Æ°á»£c

```bash
# Kiá»ƒm tra tunnel
echo $VSCODE_FORWARD_URL

# Test endpoint
curl https://your-tunnel-url/payment/momo/notify
```

**Giáº£i phÃ¡p:**
- Kiá»ƒm tra VS Code tunnel cÃ²n hoáº¡t Ä‘á»™ng
- Äáº£m báº£o URL lÃ  HTTPS
- Kiá»ƒm tra firewall/network

### OAuth2 Issues

#### Google/Facebook login khÃ´ng hoáº¡t Ä‘á»™ng

**Kiá»ƒm tra:**
1. Callback URL trong console: `http://localhost:8080/login/oauth2/code/google`
2. Client ID vÃ  Secret Ä‘Ãºng
3. OAuth consent screen Ä‘Ã£ cáº¥u hÃ¬nh

### WebSocket/SSE Issues

#### SSE khÃ´ng stream

```javascript
// Kiá»ƒm tra káº¿t ná»‘i
const eventSource = new EventSource('/sse/orders/123');
eventSource.onerror = (error) => {
    console.error('SSE Error:', error);
};
```

**Giáº£i phÃ¡p:**
- Kiá»ƒm tra CORS settings
- Äáº£m báº£o khÃ´ng cÃ³ proxy/CDN cháº·n SSE
- Kiá»ƒm tra timeout settings

### Performance Issues

#### á»¨ng dá»¥ng cháº¡y cháº­m

```bash
# Kiá»ƒm tra memory
jps -lvm

# TÄƒng heap size
export JAVA_OPTS="-Xms512m -Xmx2048m"
./mvnw spring-boot:run
```

**Tá»‘i Æ°u hÃ³a:**
- Báº­t cache cho GHN locations
- Sá»­ dá»¥ng connection pooling
- Tá»‘i Æ°u query database
- Báº­t compression

### Logs & Debugging

```bash
# Xem logs
tail -f logs/app.log

# TÄƒng log level
export LOGGING_LEVEL_COM_EXAMPLE_DEMO=DEBUG

# Actuator health check
curl http://localhost:8080/actuator/health
```

---

## ğŸ“ LiÃªn há»‡ & Há»— trá»£

### NhÃ³m phÃ¡t triá»ƒn

- **VÅ© ToÃ n Tháº¯ng** - Team Lead & Backend Developer
- **Nguyá»…n Nháº­t Huy** - Full-stack Developer
- **Äáº·ng Ngá»c TÃ i** - Backend Developer
- **Phan Quá»‘c Viá»…n** - Frontend Developer

### BÃ¡o lá»—i & GÃ³p Ã½

Náº¿u báº¡n gáº·p lá»—i hoáº·c cÃ³ Ã½ tÆ°á»Ÿng má»›i, vui lÃ²ng:
1. Táº¡o issue trÃªn GitHub
2. MÃ´ táº£ chi tiáº¿t váº¥n Ä‘á»
3. ÄÃ­nh kÃ¨m logs vÃ  screenshots náº¿u cÃ³

### ÄÃ³ng gÃ³p

ChÃºng tÃ´i hoan nghÃªnh má»i Ä‘Ã³ng gÃ³p! Vui lÃ²ng:
1. Fork repository
2. Táº¡o branch má»›i (`git checkout -b feature/AmazingFeature`)
3. Commit thay Ä‘á»•i (`git commit -m 'Add some AmazingFeature'`)
4. Push lÃªn branch (`git push origin feature/AmazingFeature`)
5. Táº¡o Pull Request

---

## ğŸ“„ Giáº¥y phÃ©p

Dá»± Ã¡n nÃ y Ä‘Æ°á»£c phÃ¢n phá»‘i dÆ°á»›i **MIT License**.

```
MIT License

Copyright (c) 2025 StarShop Team

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```

Xem file [LICENSE](LICENSE) Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t.

---

## ğŸŒ English Summary

**StarShop** is a comprehensive e-commerce platform built with Spring Boot for flower shop management and online sales.

### Key Features
- **Authentication**: OAuth2 (Google/Facebook), JWT, OTP password recovery
- **Product Management**: Full CRUD with AI-powered descriptions
- **Order Processing**: Real-time cart, checkout, order tracking
- **Payment Integration**: MoMo payment gateway with SSE updates
- **Shipping**: GHN (Giao Hang Nhanh) API integration
- **AI Assistant**: Google Gemini-powered chatbot with WebSocket
- **Admin Dashboard**: Analytics, reports, customer segmentation
- **Staff Portal**: Order management, timesheet, payroll

### Tech Stack
- **Backend**: Spring Boot 3.5.5, Spring Security, Spring Data JPA
- **Frontend**: Thymeleaf, Bootstrap 5, JavaScript
- **Database**: PostgreSQL 15
- **AI**: Google Gemini 2.5-flash
- **Documentation**: Swagger/OpenAPI 3.0
- **Deployment**: Docker, Docker Compose

### Quick Start
```bash
# Start PostgreSQL
docker compose up -d

# Run application
./mvnw spring-boot:run

# Access at http://localhost:8080
```

**Note**: Configure all secrets via environment variables in production.

---

<div align="center">

**â­ Náº¿u báº¡n tháº¥y dá»± Ã¡n há»¯u Ã­ch, hÃ£y cho chÃºng tÃ´i má»™t star! â­**

**Copyright Â© 2025 StarShop Team. All rights reserved.**

</div>

---



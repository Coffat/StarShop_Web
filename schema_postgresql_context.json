{
  "Lưu ý":
  {
    "lưu ý": "Tên bảng tạo trong database tất cả đều là viết thường"
  },
  "database_info": {
    "name": "Flower Store Management System",
    "description": "Hệ thống quản lý web bán hoa với đầy đủ chức năng e-commerce",
    "database_type": "PostgreSQL",
    "version": "Latest",
    "schema_file": "docker/init/init_schema.sql"
  },
  "enums": {
    "user_role": {
      "description": "Vai trò người dùng trong hệ thống",
      "values": ["customer", "staff", "admin"],
      "default": "customer"
    },
    "order_status": {
      "description": "Trạng thái đơn hàng",
      "values": ["pending", "processing", "shipped", "completed", "cancelled"],
      "default": "pending"
    },
    "discount_type": {
      "description": "Loại giảm giá voucher",
      "values": ["percentage", "fixed"]
    },
    "payment_method": {
      "description": "Phương thức thanh toán",
      "values": ["cash_on_delivery", "credit_card", "bank_transfer", "wallet"],
      "default": "cash_on_delivery"
    },
    "transaction_type": {
      "description": "Loại giao dịch",
      "values": ["payment", "refund"]
    },
    "transaction_status": {
      "description": "Trạng thái giao dịch",
      "values": ["success", "failed"],
      "default": "failed"
    },
    "product_status": {
      "description": "Trạng thái sản phẩm",
      "values": ["active", "inactive", "out_of_stock", "discontinued"],
      "default": "active"
    },
    "salary_status": {
      "description": "Trạng thái lương nhân viên",
      "values": ["pending", "paid", "overdue"],
      "default": "pending"
    }
  },
  "tables": {
    "Users": {
      "description": "Bảng lưu trữ thông tin người dùng bao gồm khách hàng, nhân viên và admin",
      "primary_key": "id",
      "columns": {
        "id": "BIGSERIAL PRIMARY KEY",
        "firstname": "VARCHAR(100) NOT NULL",
        "lastname": "VARCHAR(100) NOT NULL", 
        "email": "VARCHAR(255) UNIQUE NOT NULL",
        "password": "VARCHAR(255) NOT NULL (min 8 chars)",
        "phone": "VARCHAR(20) UNIQUE NOT NULL",
        "avatar": "VARCHAR(255) DEFAULT NULL",
        "role": "user_role NOT NULL DEFAULT 'customer'",
        "created_at": "TIMESTAMP NOT NULL",
        "updated_at": "TIMESTAMP"
      },
      "indexes": ["email", "phone"],
      "business_rules": ["Mật khẩu phải có ít nhất 8 ký tự"]
    },
    "Addresses": {
      "description": "Địa chỉ giao hàng của người dùng",
      "primary_key": "id",
      "foreign_keys": {
        "user_id": "Users(id) ON DELETE CASCADE"
      },
      "columns": {
        "id": "BIGSERIAL PRIMARY KEY",
        "user_id": "BIGINT NOT NULL",
        "street": "VARCHAR(255) NOT NULL",
        "city": "VARCHAR(100) NOT NULL",
        "province": "VARCHAR(100) NOT NULL",
        "is_default": "BOOLEAN NOT NULL DEFAULT FALSE",
        "created_at": "TIMESTAMP NOT NULL",
        "updated_at": "TIMESTAMP"
      },
      "indexes": ["user_id"]
    },
    "Products": {
      "description": "Danh mục sản phẩm hoa",
      "primary_key": "id",
      "columns": {
        "id": "BIGSERIAL PRIMARY KEY",
        "name": "VARCHAR(255) NOT NULL",
        "description": "TEXT DEFAULT NULL",
        "price": "NUMERIC(10,2) NOT NULL DEFAULT 0.00",
        "image": "VARCHAR(255) DEFAULT NULL",
        "stock_quantity": "INTEGER DEFAULT 0",
        "status": "product_status DEFAULT 'active'",
        "catalog_id": "BIGINT",
        "created_at": "TIMESTAMP NOT NULL",
        "updated_at": "TIMESTAMP"
      },
      "foreign_keys": {
        "catalog_id": "Catalogs(id) ON DELETE SET NULL"
      },
      "indexes": ["name", "stock_quantity", "catalog_id"],
      "business_rules": ["Giá >= 0", "Số lượng tồn kho >= 0"]
    },
    "Catalogs": {
      "description": "Danh mục sản phẩm (Categories)",
      "primary_key": "id",
      "columns": {
        "id": "BIGSERIAL PRIMARY KEY",
        "value": "VARCHAR(100) UNIQUE NOT NULL",
        "created_at": "TIMESTAMP NOT NULL",
        "updated_at": "TIMESTAMP"
      },
      "indexes": ["value"]
    },
    "DeliveryUnits": {
      "description": "Đơn vị vận chuyển",
      "primary_key": "id",
      "columns": {
        "id": "BIGSERIAL PRIMARY KEY",
        "name": "VARCHAR(100) UNIQUE NOT NULL",
        "estimated_time": "VARCHAR(50) DEFAULT NULL",
        "is_active": "BOOLEAN DEFAULT TRUE",
        "created_at": "TIMESTAMP NOT NULL",
        "updated_at": "TIMESTAMP"
      },
      "indexes": ["is_active"],
      "business_rules": []
    },
    "Vouchers": {
      "description": "Mã giảm giá",
      "primary_key": "id",
      "columns": {
        "id": "BIGSERIAL PRIMARY KEY",
        "code": "VARCHAR(50) UNIQUE NOT NULL",
        "discount_value": "NUMERIC(10,2) NOT NULL",
        "discount_type": "discount_type NOT NULL",
        "expiry_date": "DATE NOT NULL",
        "min_order_value": "NUMERIC(10,2) DEFAULT 0.00",
        "max_uses": "INTEGER DEFAULT NULL",
        "uses": "INTEGER NOT NULL DEFAULT 0",
        "is_active": "BOOLEAN DEFAULT TRUE",
        "created_at": "TIMESTAMP NOT NULL",
        "updated_at": "TIMESTAMP"
      },
      "indexes": ["code", "is_active"],
      "business_rules": ["Giá trị giảm > 0", "Số lần sử dụng <= số lần tối đa"]
    },
    "Orders": {
      "description": "Đơn hàng khách hàng với trạng thái và thông tin thanh toán",
      "primary_key": "id",
      "foreign_keys": {
        "user_id": "Users(id)",
        "delivery_unit_id": "DeliveryUnits(id)",
        "voucher_id": "Vouchers(id)",
        "address_id": "Addresses(id)"
      },
      "columns": {
        "id": "VARCHAR(20) PRIMARY KEY",
        "user_id": "BIGINT NOT NULL",
        "total_amount": "NUMERIC(10,2) NOT NULL DEFAULT 0.00",
        "status": "order_status NOT NULL DEFAULT 'pending'",
        "order_date": "TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP",
        "delivery_unit_id": "BIGINT DEFAULT NULL",
        "voucher_id": "BIGINT DEFAULT NULL",
        "address_id": "BIGINT NOT NULL",
        "payment_method": "payment_method NOT NULL DEFAULT 'cash_on_delivery'",
        "notes": "TEXT DEFAULT NULL"
      },
      "indexes": ["user_id", "status", "(user_id, status)"],
      "business_rules": ["Tổng tiền >= 0"]
    },
    "OrderItems": {
      "description": "Sản phẩm trong đơn hàng",
      "primary_key": "id",
      "foreign_keys": {
        "order_id": "Orders(id) ON DELETE CASCADE",
        "product_id": "Products(id)"
      },
      "columns": {
        "id": "BIGSERIAL PRIMARY KEY",
        "order_id": "VARCHAR(20) NOT NULL",
        "product_id": "BIGINT NOT NULL",
        "quantity": "INTEGER NOT NULL DEFAULT 1",
        "price": "NUMERIC(10,2) NOT NULL"
      },
      "indexes": ["order_id"],
      "business_rules": ["Số lượng > 0"]
    },
    "Carts": {
      "description": "Giỏ hàng của người dùng",
      "primary_key": "id",
      "foreign_keys": {
        "user_id": "Users(id) ON DELETE CASCADE"
      },
      "columns": {
        "id": "BIGSERIAL PRIMARY KEY",
        "user_id": "BIGINT UNIQUE NOT NULL",
        "total_amount": "NUMERIC(10,2) DEFAULT 0.00",
        "created_at": "TIMESTAMP NOT NULL",
        "updated_at": "TIMESTAMP",
        "total_quantity": "INTEGER DEFAULT 0"
      },
      "business_rules": ["Tổng tiền >= 0", "Tổng số lượng >= 0"]
    },
    "CartItems": {
      "description": "Sản phẩm trong giỏ hàng",
      "primary_key": "id",
      "foreign_keys": {
        "cart_id": "Carts(id) ON DELETE CASCADE",
        "product_id": "Products(id)"
      },
      "columns": {
        "id": "BIGSERIAL PRIMARY KEY",
        "cart_id": "BIGINT NOT NULL",
        "product_id": "BIGINT NOT NULL",
        "quantity": "INTEGER NOT NULL DEFAULT 1",
        "created_at": "TIMESTAMP NOT NULL",
        "updated_at": "TIMESTAMP"
      },
      "unique_constraints": ["(cart_id, product_id)"],
      "business_rules": ["Số lượng > 0"]
    },
    "Reviews": {
      "description": "Đánh giá và xếp hạng sản phẩm",
      "primary_key": "id",
      "foreign_keys": {
        "user_id": "Users(id)",
        "product_id": "Products(id) ON DELETE CASCADE",
        "order_item_id": "OrderItems(id) ON DELETE CASCADE"
      },
      "columns": {
        "id": "BIGSERIAL PRIMARY KEY",
        "user_id": "BIGINT NOT NULL",
        "product_id": "BIGINT NOT NULL",
        "rating": "SMALLINT NOT NULL",
        "comment": "TEXT DEFAULT NULL",
        "created_at": "TIMESTAMP NOT NULL",
        "updated_at": "TIMESTAMP",
        "order_item_id": "BIGINT UNIQUE"
      },
      "indexes": ["product_id"],
      "business_rules": ["Điểm đánh giá từ 1-5"]
    },
    "Follows": {
      "description": "Theo dõi sản phẩm của người dùng",
      "primary_key": "id",
      "foreign_keys": {
        "user_id": "Users(id)",
        "product_id": "Products(id) ON DELETE CASCADE"
      },
      "columns": {
        "id": "BIGSERIAL PRIMARY KEY",
        "user_id": "BIGINT NOT NULL",
        "product_id": "BIGINT NOT NULL",
        "followed_at": "TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP"
      },
      "unique_constraints": ["(user_id, product_id)"],
      "indexes": ["product_id"]
    },
    "Messages": {
      "description": "Tin nhắn giữa người dùng",
      "primary_key": "id",
      "foreign_keys": {
        "sender_id": "Users(id)",
        "receiver_id": "Users(id)"
      },
      "columns": {
        "id": "BIGSERIAL PRIMARY KEY",
        "sender_id": "BIGINT NOT NULL",
        "receiver_id": "BIGINT NOT NULL",
        "content": "TEXT NOT NULL",
        "sent_at": "TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP",
        "is_read": "BOOLEAN NOT NULL DEFAULT FALSE"
      },
      "indexes": ["(sender_id, receiver_id, sent_at)", "sent_at"]
    },
    "Transactions": {
      "description": "Giao dịch thanh toán/hoàn tiền",
      "primary_key": "id",
      "foreign_keys": {
        "user_id": "Users(id)",
        "order_id": "Orders(id)"
      },
      "columns": {
        "id": "BIGSERIAL PRIMARY KEY",
        "user_id": "BIGINT NOT NULL",
        "order_id": "VARCHAR(20) DEFAULT NULL",
        "amount": "NUMERIC(10,2) NOT NULL",
        "type": "transaction_type NOT NULL",
        "status": "transaction_status NOT NULL DEFAULT 'failed'",
        "transaction_reference": "VARCHAR(255) DEFAULT NULL",
        "notes": "TEXT DEFAULT NULL",
        "created_at": "TIMESTAMP NOT NULL",
        "updated_at": "TIMESTAMP"
      },
      "indexes": ["order_id", "created_at", "transaction_reference"],
      "business_rules": ["Số tiền > 0"]
    },
    "TimeSheets": {
      "description": "Theo dõi giờ làm việc của nhân viên",
      "primary_key": "id",
      "foreign_keys": {
        "staff_id": "Users(id)"
      },
      "columns": {
        "id": "BIGSERIAL PRIMARY KEY",
        "staff_id": "BIGINT NOT NULL",
        "check_in": "TIMESTAMP NOT NULL",
        "check_out": "TIMESTAMP DEFAULT NULL",
        "date": "DATE NOT NULL",
        "hours_worked": "NUMERIC(5,2) DEFAULT 0.00",
        "notes": "TEXT DEFAULT NULL"
      },
      "indexes": ["(staff_id, date)"],
      "business_rules": ["Giờ làm >= 0", "Giờ ra >= giờ vào"]
    },
    "Salaries": {
      "description": "Bản ghi lương nhân viên đơn giản, dựa trên mức lương theo giờ và tổng giờ làm việc",
      "primary_key": "id",
      "foreign_keys": {
        "user_id": "Users(id) ON DELETE CASCADE"
      },
      "columns": {
        "id": "BIGSERIAL PRIMARY KEY",
        "user_id": "BIGINT NOT NULL",
        "base_salary": "NUMERIC(10,2) NOT NULL",
        "working_time": "NUMERIC(5,2) NOT NULL DEFAULT 0.00",
        "total_salary": "NUMERIC(10,2) GENERATED ALWAYS AS (base_salary * working_time) STORED",
        "month_year": "DATE NOT NULL",
        "status": "salary_status NOT NULL DEFAULT 'pending'",
        "notes": "TEXT DEFAULT NULL",
        "created_at": "TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP",
        "updated_at": "TIMESTAMP"
      },
      "unique_constraints": ["(user_id, month_year)"],
      "indexes": ["user_id", "month_year"],
      "business_rules": ["Lương cơ bản >= 0", "Thời gian làm >= 0"]
    }
  },
  "relationships": {
    "user_management": {
      "Users": ["Addresses", "Orders", "Carts", "Reviews", "Follows", "Messages", "Transactions", "TimeSheets", "Salaries"],
      "description": "Người dùng có thể có nhiều địa chỉ, đơn hàng, đánh giá, theo dõi sản phẩm và gửi tin nhắn"
    },
    "product_management": {
      "Products": ["OrderItems", "CartItems", "Reviews", "Follows"],
      "Catalogs": ["Products"],
      "description": "Sản phẩm thuộc danh mục, xuất hiện trong đơn hàng và giỏ hàng, được đánh giá và theo dõi"
    },
    "order_management": {
      "Orders": ["OrderItems", "Transactions"],
      "description": "Đơn hàng chứa nhiều sản phẩm và có thể có nhiều giao dịch"
    },
    "cart_management": {
      "Carts": ["CartItems"],
      "description": "Giỏ hàng chứa nhiều sản phẩm"
    }
  },
  "business_logic": {
    "user_roles": {
      "customer": "Khách hàng có thể mua hàng, đánh giá sản phẩm, theo dõi sản phẩm",
      "staff": "Nhân viên có thể quản lý đơn hàng, theo dõi giờ làm việc",
      "admin": "Quản trị viên có quyền truy cập đầy đủ hệ thống"
    },
    "order_flow": {
      "pending": "Đơn hàng mới được tạo",
      "processing": "Đơn hàng đang được xử lý",
      "shipped": "Đơn hàng đã được gửi",
      "completed": "Đơn hàng hoàn thành",
      "cancelled": "Đơn hàng bị hủy"
    },
    "inventory_management": {
      "stock_tracking": "Theo dõi số lượng tồn kho sản phẩm",
      "product_status": "Quản lý trạng thái sản phẩm (hoạt động, ngừng bán, hết hàng)"
    },
    "payment_system": {
      "methods": ["Thanh toán khi nhận hàng", "Thẻ tín dụng", "Chuyển khoản ngân hàng", "Ví điện tử"],
      "transactions": "Theo dõi giao dịch thanh toán và hoàn tiền"
    },
    "discount_system": {
      "voucher_types": ["Phần trăm", "Số tiền cố định"],
      "usage_limits": "Giới hạn số lần sử dụng và giá trị đơn hàng tối thiểu"
    }
  },
  "performance_optimization": {
    "indexes": {
      "user_lookup": "email, phone",
      "order_queries": "user_id, status, (user_id, status)",
      "product_search": "name, stock_quantity",
      "review_display": "product_id",
      "message_conversation": "(sender_id, receiver_id, sent_at)",
      "transaction_tracking": "order_id, created_at, transaction_reference"
    },
    "unique_constraints": [
      "Email và số điện thoại người dùng",
      "Sản phẩm trong giỏ hàng",
      "Theo dõi sản phẩm của người dùng",
      "Lương theo tháng của nhân viên"
    ]
  },
  "data_integrity": {
    "foreign_key_constraints": "Tất cả các khóa ngoại đều có ràng buộc để đảm bảo tính toàn vẹn dữ liệu",
    "check_constraints": [
      "Mật khẩu tối thiểu 8 ký tự",
      "Giá sản phẩm và phí vận chuyển >= 0",
      "Số lượng trong kho >= 0",
      "Điểm đánh giá từ 1-5",
      "Thời gian làm việc >= 0"
    ],
    "cascade_deletes": "Xóa người dùng sẽ xóa địa chỉ, giỏ hàng và các dữ liệu liên quan"
  }
}

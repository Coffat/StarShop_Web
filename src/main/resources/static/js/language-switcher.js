// Language Switcher for StarShop
// Handles language switching functionality with localStorage persistence

class LanguageSwitcher {
    constructor() {
        this.currentLanguage = localStorage.getItem('starshop-language') || 'vi';
        this.translations = {};
        this.init();
    }

    init() {
        this.loadTranslations();
        this.updateLanguageDisplay();
        this.bindEvents();
        this.applyLanguage();
    }

    // Load translation data
    loadTranslations() {
        this.translations = {
            vi: {
                // Header
                'search-placeholder': 'üå∏ T√¨m hoa nhanh - Hoa sinh nh·∫≠t, t√¨nh y√™u, c∆∞·ªõi...',
                'login': 'ƒêƒÉng nh·∫≠p',
                'register': 'ƒêƒÉng k√Ω',
                'profile': 'Th√¥ng tin c√° nh√¢n',
                'orders': 'ƒê∆°n h√†ng c·ªßa t√¥i',
                'wishlist': 'Danh s√°ch y√™u th√≠ch',
                'settings': 'C√†i ƒë·∫∑t',
                'logout': 'ƒêƒÉng xu·∫•t',
                'customer-role': 'Kh√°ch h√†ng',
                
                // Navigation
                'home': 'Trang ch·ªß',
                'categories': 'Danh m·ª•c hoa',
                'products': 'S·∫£n ph·∫©m',
                'gifts': 'Qu√† t·∫∑ng',
                'occasions': 'D·ªãp ƒë·∫∑c bi·ªát',
                'blog': 'Blog',
                'contact': 'Li√™n h·ªá',
                
                // Categories
                'birthday-flowers': 'Hoa sinh nh·∫≠t',
                'love-flowers': 'Hoa t√¨nh y√™u',
                'wedding-flowers': 'Hoa c∆∞·ªõi',
                'opening-flowers': 'Hoa khai tr∆∞∆°ng',
                'sympathy-flowers': 'Hoa chia bu·ªìn',
                'mother-flowers': 'Hoa t·∫∑ng m·∫π',
                
                // Home page
                'hero-title': 'Mang Hoa ƒê·∫øn Ni·ªÅm Vui C·ªßa B·∫°n',
                'hero-subtitle': 'Kh√°m ph√° b·ªô s∆∞u t·∫≠p hoa t∆∞∆°i cao c·∫•p ƒë∆∞·ª£c tuy·ªÉn ch·ªçn k·ªπ l∆∞·ª°ng, mang ƒë·∫øn nh·ªØng kho·∫£nh kh·∫Øc ƒë·∫∑c bi·ªát nh·∫•t trong cu·ªôc s·ªëng',
                'explore-products': 'Kh√°m ph√° s·∫£n ph·∫©m',
                'view-catalog': 'Xem danh m·ª•c',
                'fresh-daily': 'Hoa t∆∞∆°i m·ªói ng√†y',
                'hero-title-part1': 'Mang',
                'hero-title-part2': 'hoa ƒë·∫øn',
                'hero-title-part3': 'ni·ªÅm vui c·ªßa b·∫°n',
                'hero-description': 'Kh√°m ph√° b·ªô s∆∞u t·∫≠p hoa t∆∞∆°i tuy·ªát ƒë·∫πp t·∫°i StarShop. Ch√∫ng t√¥i mang ƒë·∫øn nh·ªØng b√≥ hoa tinh t·∫ø, ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·∫∑c bi·ªát cho m·ªçi kho·∫£nh kh·∫Øc ƒë√°ng nh·ªõ c·ªßa b·∫°n.',
                'happy-customers': 'Kh√°ch h√†ng h√†i l√≤ng',
                'unique-designs': 'M·∫´u hoa ƒë·ªôc ƒë√°o',
                'customer-support': 'H·ªó tr·ª£ kh√°ch h√†ng',
                'explore-now': 'Kh√°m ph√° ngay',
                'view-categories': 'Xem danh m·ª•c',
                'rating': '4.9',
                'rating-desc': 'ƒê√°nh gi√°',
                'why-starshop-desc': 'Ch√∫ng t√¥i cam k·∫øt mang ƒë·∫øn tr·∫£i nghi·ªám tuy·ªát v·ªùi nh·∫•t',
                'featured-categories': 'Danh m·ª•c n·ªïi b·∫≠t',
                'featured-categories-desc': 'T√¨m ki·∫øm b√≥ hoa ho√†n h·∫£o cho m·ªçi d·ªãp ƒë·∫∑c bi·ªát',
                'explore-collection': 'Kh√°m ph√° b·ªô s∆∞u t·∫≠p',
                'explore': 'Kh√°m ph√°',
                'view-all-categories': 'Xem t·∫•t c·∫£ danh m·ª•c',
                'featured-products-desc': 'Nh·ªØng b√≥ hoa ƒë∆∞·ª£c y√™u th√≠ch nh·∫•t t·∫°i StarShop',
                'out-of-stock': 'H·∫æT H√ÄNG',
                'out-of-stock-badge': 'H·∫øt h√†ng',
                'low-stock': 'S·∫Øp h·∫øt',
                'featured': 'N·ªïi b·∫≠t',
                'remaining': 'C√≤n',
                'view-all-products': 'Xem t·∫•t c·∫£ s·∫£n ph·∫©m',
                'special-offer': '∆Øu ƒë√£i ƒë·∫∑c bi·ªát',
                'discount-20': 'Gi·∫£m 20%',
                'first-order': 'cho ƒë∆°n h√†ng ƒë·∫ßu ti√™n',
                'promo-desc': 'Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi StarShop! Nh·∫≠n ngay ∆∞u ƒë√£i h·∫•p d·∫´n khi mua s·∫Øm l·∫ßn ƒë·∫ßu.',
                'shop-now': 'Mua s·∫Øm ngay',
                'free-shipping': 'Mi·ªÖn ph√≠ giao h√†ng',
                'hcm-area': 'N·ªôi th√†nh TPHCM',
                'delivery-2h': 'Giao h√†ng 2 gi·ªù',
                'fast-reliable': 'Nhanh ch√≥ng & tin c·∫≠y',
                'fresh-flowers-100': 'Hoa t∆∞∆°i 100%',
                'quality-guaranteed': 'ƒê·∫£m b·∫£o ch·∫•t l∆∞·ª£ng',
                'five-star-rating': 'ƒê√°nh gi√° 5 sao',
                'from-customers': 'T·ª´ kh√°ch h√†ng',
                'customer-reviews': 'ƒê√°nh gi√° t·ª´ kh√°ch h√†ng',
                'what-customers-say': 'Kh√°ch h√†ng n√≥i g√¨ v·ªÅ ch√∫ng t√¥i',
                'testimonials-desc': 'H√†ng ngh√¨n kh√°ch h√†ng ƒë√£ tin t∆∞·ªüng v√† h√†i l√≤ng v·ªõi d·ªãch v·ª• c·ªßa StarShop',
                
                // Why StarShop
                'why-starshop': 'T·∫°i sao ch·ªçn StarShop?',
                'fresh-flowers': 'Hoa t∆∞∆°i 100%',
                'fresh-desc': 'Cam k·∫øt hoa t∆∞∆°i nh·∫≠p kh·∫©u tr·ª±c ti·∫øp',
                'fast-delivery': 'Giao h√†ng nhanh',
                'fast-desc': 'Giao h√†ng trong 2 gi·ªù n·ªôi th√†nh HCM',
                'professional-design': 'Thi·∫øt k·∫ø chuy√™n nghi·ªáp',
                'design-desc': 'ƒê·ªôi ng≈© florist chuy√™n nghi·ªáp',
                'support-247': 'H·ªó tr·ª£ 24/7',
                'support-desc': 'T∆∞ v·∫•n v√† h·ªó tr·ª£ m·ªçi l√∫c',
                
                // Products
                'featured-products': 'S·∫£n ph·∫©m n·ªïi b·∫≠t',
                'quick-add': 'Th√™m nhanh',
                'adding': 'ƒêang th√™m...',
                'added': 'ƒê√£ th√™m',
                'add-to-cart': 'Th√™m',
                'add-to-cart-success': 'ƒê√£ th√™m s·∫£n ph·∫©m v√†o gi·ªè h√†ng!',
                
                // Cart page
                'cart-title': 'Gi·ªè h√†ng c·ªßa b·∫°n',
                'cart-subtitle': 's·∫£n ph·∫©m trong gi·ªè h√†ng',
                'select-all': 'Ch·ªçn t·∫•t c·∫£ s·∫£n ph·∫©m',
                'cart-summary': 'T·ªïng c·ªông gi·ªè h√†ng',
                'unit-price': 'ƒê∆°n gi√°',
                'quantity': 'S·ªë l∆∞·ª£ng',
                'subtotal': 'Th√†nh ti·ªÅn',
                'total-quantity': 'T·ªïng s·ªë l∆∞·ª£ng',
                'temporary-total': 'T·∫°m t√≠nh',
                'final-total': 'T·ªïng ti·ªÅn',
                'selected-items': 's·∫£n ph·∫©m ƒë∆∞·ª£c ch·ªçn',
                'proceed-checkout': 'Ti·∫øn h√†nh thanh to√°n',
                'continue-shopping': 'Ti·∫øp t·ª•c mua s·∫Øm',
                'clear-cart': 'X√≥a t·∫•t c·∫£',
                'shipping-note': 'Ph√≠ v·∫≠n chuy·ªÉn s·∫Ω ƒë∆∞·ª£c t√≠nh ·ªü b∆∞·ªõc thanh to√°n',
                'empty-cart-title': 'Gi·ªè h√†ng tr·ªëng',
                'empty-cart-desc': 'B·∫°n ch∆∞a c√≥ s·∫£n ph·∫©m n√†o trong gi·ªè h√†ng. H√£y kh√°m ph√° c√°c s·∫£n ph·∫©m tuy·ªát v·ªùi c·ªßa ch√∫ng t√¥i!',
                'explore-products': 'Kh√°m ph√° s·∫£n ph·∫©m',
                
                // Footer
                'language': 'Ng√¥n ng·ªØ',
                'vietnamese': 'Ti·∫øng Vi·ªát',
                'english': 'English'
            },
            en: {
                // Header
                'search-placeholder': 'üå∏ Search flowers quickly - Birthday, love, wedding...',
                'login': 'Login',
                'register': 'Register',
                'profile': 'Profile',
                'orders': 'My Orders',
                'wishlist': 'Wishlist',
                'settings': 'Settings',
                'logout': 'Logout',
                'customer-role': 'Customer',
                
                // Navigation
                'home': 'Home',
                'categories': 'Categories',
                'products': 'Products',
                'gifts': 'Gifts',
                'occasions': 'Occasions',
                'blog': 'Blog',
                'contact': 'Contact',
                
                // Categories
                'birthday-flowers': 'Birthday Flowers',
                'love-flowers': 'Love Flowers',
                'wedding-flowers': 'Wedding Flowers',
                'opening-flowers': 'Opening Flowers',
                'sympathy-flowers': 'Sympathy Flowers',
                'mother-flowers': 'Mother Flowers',
                
                // Home page
                'hero-title': 'Bringing Flowers to Your Joy',
                'hero-subtitle': 'Discover our premium collection of fresh flowers carefully curated to bring the most special moments in life',
                'explore-products': 'Explore Products',
                'view-catalog': 'View Catalog',
                'fresh-daily': 'Fresh Daily Flowers',
                'hero-title-part1': 'Bringing',
                'hero-title-part2': 'flowers to',
                'hero-title-part3': 'your joy',
                'hero-description': 'Discover our beautiful collection of fresh flowers at StarShop. We bring you exquisite bouquets, specially designed for every memorable moment in your life.',
                'happy-customers': 'Happy Customers',
                'unique-designs': 'Unique Designs',
                'customer-support': 'Customer Support',
                'explore-now': 'Explore Now',
                'view-categories': 'View Categories',
                'rating': '4.9',
                'rating-desc': 'Rating',
                'why-starshop-desc': 'We are committed to bringing you the best experience',
                'featured-categories': 'Featured Categories',
                'featured-categories-desc': 'Find the perfect bouquet for every special occasion',
                'explore-collection': 'Explore Collection',
                'explore': 'Explore',
                'view-all-categories': 'View All Categories',
                'featured-products-desc': 'Most loved bouquets at StarShop',
                'out-of-stock': 'OUT OF STOCK',
                'out-of-stock-badge': 'Out of Stock',
                'low-stock': 'Low Stock',
                'featured': 'Featured',
                'remaining': 'Remaining',
                'view-all-products': 'View All Products',
                'special-offer': 'Special Offer',
                'discount-20': '20% Off',
                'first-order': 'for your first order',
                'promo-desc': 'Welcome to StarShop! Get amazing deals on your first purchase.',
                'shop-now': 'Shop Now',
                'free-shipping': 'Free Shipping',
                'hcm-area': 'Ho Chi Minh City Area',
                'delivery-2h': '2-Hour Delivery',
                'fast-reliable': 'Fast & Reliable',
                'fresh-flowers-100': '100% Fresh Flowers',
                'quality-guaranteed': 'Quality Guaranteed',
                'five-star-rating': '5-Star Rating',
                'from-customers': 'From Customers',
                'customer-reviews': 'Customer Reviews',
                'what-customers-say': 'What Our Customers Say',
                'testimonials-desc': 'Thousands of customers have trusted and been satisfied with StarShop services',
                
                // Why StarShop
                'why-starshop': 'Why Choose StarShop?',
                'fresh-flowers': '100% Fresh Flowers',
                'fresh-desc': 'Direct import fresh flowers guarantee',
                'fast-delivery': 'Fast Delivery',
                'fast-desc': '2-hour delivery in Ho Chi Minh City',
                'professional-design': 'Professional Design',
                'design-desc': 'Professional florist team',
                'support-247': '24/7 Support',
                'support-desc': 'Consultation and support anytime',
                
                // Products
                'featured-products': 'Featured Products',
                'quick-add': 'Quick Add',
                'adding': 'Adding...',
                'added': 'Added',
                'add-to-cart': 'Add',
                'add-to-cart-success': 'Product added to cart!',
                
                // Cart page
                'cart-title': 'Your Cart',
                'cart-subtitle': 'items in cart',
                'select-all': 'Select all products',
                'cart-summary': 'Cart Summary',
                'unit-price': 'Unit Price',
                'quantity': 'Quantity',
                'subtotal': 'Subtotal',
                'total-quantity': 'Total Quantity',
                'temporary-total': 'Subtotal',
                'final-total': 'Total',
                'selected-items': 'items selected',
                'proceed-checkout': 'Proceed to Checkout',
                'continue-shopping': 'Continue Shopping',
                'clear-cart': 'Clear All',
                'shipping-note': 'Shipping fee will be calculated at checkout',
                'empty-cart-title': 'Empty Cart',
                'empty-cart-desc': 'You have no items in your cart. Explore our amazing products!',
                'explore-products': 'Explore Products',
                
                // Footer
                'language': 'Language',
                'vietnamese': 'Vietnamese',
                'english': 'English'
            }
        };
    }

    // Update language display in switcher
    updateLanguageDisplay() {
        const languageTexts = document.querySelectorAll('.language-text');
        const languageButtons = document.querySelectorAll('button span.text-sm.font-medium.text-gray-700');
        
        // Update button text (VI/EN)
        languageButtons.forEach(button => {
            if (button.textContent === 'VI' || button.textContent === 'EN') {
                button.textContent = this.currentLanguage.toUpperCase();
            }
        });
        
        languageTexts.forEach(text => {
            text.textContent = this.currentLanguage.toUpperCase();
        });

        // Update active state
        document.querySelectorAll('.language-option').forEach(option => {
            option.classList.remove('active');
            if (option.dataset.lang === this.currentLanguage) {
                option.classList.add('active');
            }
        });

        document.querySelectorAll('.mobile-language-option').forEach(option => {
            option.classList.remove('active');
            if (option.dataset.lang === this.currentLanguage) {
                option.classList.add('active');
            }
        });
    }

    // Bind click events
    bindEvents() {
        // Desktop language options
        document.querySelectorAll('.language-option').forEach(option => {
            option.addEventListener('click', (e) => {
                e.preventDefault();
                this.switchLanguage(option.dataset.lang);
            });
        });

        // Mobile language options
        document.querySelectorAll('.mobile-language-option').forEach(option => {
            option.addEventListener('click', (e) => {
                e.preventDefault();
                this.switchLanguage(option.dataset.lang);
            });
        });
    }

    // Switch language
    switchLanguage(language) {
        if (language === this.currentLanguage) return;
        
        this.currentLanguage = language;
        localStorage.setItem('starshop-language', language);
        
        this.updateLanguageDisplay();
        this.applyLanguage();
        
        // Show notification
        this.showLanguageChangeNotification();
    }

    // Apply language to page elements
    applyLanguage() {
        const translations = this.translations[this.currentLanguage];
        
        // Update elements with data-translate attribute
        document.querySelectorAll('[data-translate]').forEach(element => {
            const key = element.dataset.translate;
            if (translations[key]) {
                if (element.tagName === 'INPUT' && element.type === 'text') {
                    element.placeholder = translations[key];
                } else {
                    element.textContent = translations[key];
                }
            }
        });

        // Update specific elements by ID or class
        this.updateSpecificElements(translations);
    }

    // Update specific elements that need special handling
    updateSpecificElements(translations) {
        // Search input placeholder
        const searchInputs = document.querySelectorAll('.search-input-hero, .search-input');
        searchInputs.forEach(input => {
            input.placeholder = translations['search-placeholder'];
        });

        // User role text
        const userRoles = document.querySelectorAll('.user-role');
        userRoles.forEach(role => {
            role.textContent = translations['customer-role'];
        });

        // Update page title
        if (document.title.includes('StarShop')) {
            document.title = this.currentLanguage === 'vi' ? 
                'StarShop - C·ª≠a h√†ng hoa t∆∞∆°i' : 
                'StarShop - Fresh Flower Shop';
        }
    }

    // Show language change notification
    showLanguageChangeNotification() {
        const message = this.currentLanguage === 'vi' ? 
            'ƒê√£ chuy·ªÉn sang Ti·∫øng Vi·ªát' : 
            'Switched to English';
        
        // Use existing toast function if available
        if (typeof showToast === 'function') {
            showToast(message, 'success');
        } else {
            // Fallback notification
            const notification = document.createElement('div');
            notification.className = 'language-notification';
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--primary);
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 9999;
                font-size: 14px;
                font-weight: 500;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
    }

    // Get current language
    getCurrentLanguage() {
        return this.currentLanguage;
    }

    // Get translation for a key
    translate(key) {
        return this.translations[this.currentLanguage][key] || key;
    }
}

// Initialize language switcher when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
    window.languageSwitcher = new LanguageSwitcher();
});

// Export for use in other scripts
if (typeof module !== 'undefined' && module.exports) {
    module.exports = LanguageSwitcher;
}

<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Tailwind CSS, FontAwesome v√† Chart.js ƒë√£ ƒë∆∞·ª£c import trong admin layout -->
    <!-- Custom Dashboard CSS -->
    <link rel="stylesheet" th:href="@{/css/admin-dashboard.css}">
</head>
<body>
    <!-- Dashboard Content -->
    <div class="container-fluid">
        <div class="dashboard-content">
        
        <!-- Statistics Cards -->
        <div class="stats-grid">
            <!-- Total Revenue -->
            <div class="stats-card revenue fade-in">
                <div class="card-header">
                    <div class="flex-1">
                        <h3 class="card-title">T·ªïng doanh thu</h3>
                        <p class="card-value" th:text="${#numbers.formatCurrency(stats.totalRevenue)}">0‚Ç´</p>
                        <div class="card-change">
                            <i class="fas fa-trending-up"></i>
                            <span th:text="${#numbers.formatCurrency(stats.monthlyRevenue)}">0‚Ç´</span>
                            <span>th√°ng n√†y</span>
                        </div>
                    </div>
                    <div class="card-icon">
                        <i class="fas fa-chart-line"></i>
                    </div>
                </div>
            </div>
            
            <!-- Total Orders -->
            <div class="stats-card orders fade-in" style="animation-delay: 0.1s;">
                <div class="card-header">
                    <div class="flex-1">
                        <h3 class="card-title">T·ªïng ƒë∆°n h√†ng</h3>
                        <p class="card-value" th:text="${stats.totalOrders}">0</p>
                        <div class="card-change">
                            <i class="fas fa-clock"></i>
                            <span th:text="${stats.pendingOrders}">0</span>
                            <span>ƒëang ch·ªù x·ª≠ l√Ω</span>
                        </div>
                    </div>
                    <div class="card-icon">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                </div>
            </div>
            
            <!-- Total Customers -->
            <div class="stats-card customers fade-in" style="animation-delay: 0.2s;">
                <div class="card-header">
                    <div class="flex-1">
                        <h3 class="card-title">T·ªïng kh√°ch h√†ng</h3>
                        <p class="card-value" th:text="${stats.totalUsers}">0</p>
                        <div class="card-change">
                            <i class="fas fa-arrow-up"></i>
                            <span>+15.3%</span>
                            <span>so v·ªõi th√°ng tr∆∞·ªõc</span>
                        </div>
                    </div>
                    <div class="card-icon">
                        <i class="fas fa-users"></i>
                    </div>
                </div>
            </div>
            
            <!-- Total Products -->
            <div class="stats-card products fade-in" style="animation-delay: 0.3s;">
                <div class="card-header">
                    <div class="flex-1">
                        <h3 class="card-title">T·ªïng s·∫£n ph·∫©m</h3>
                        <p class="card-value" th:text="${stats.totalProducts}">0</p>
                        <div class="card-change">
                            <i class="fas fa-check-circle"></i>
                            <span th:text="${stats.completedOrders}">0</span>
                            <span>ƒë∆°n ho√†n th√†nh</span>
                        </div>
                    </div>
                    <div class="card-icon">
                        <i class="fas fa-box"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Insights Widget -->
        <div class="ai-insights-widget" id="aiInsightsWidget" th:if="${aiInsightsEnabled}">
            <div class="ai-widget-header">
                <h3>ü§ñ AI Nh·∫≠n ƒë·ªãnh Nhanh</h3>
                <span class="loading-indicator" id="aiLoadingIndicator">
                    <i class="fas fa-spinner fa-spin"></i>
                </span>
            </div>
            <div class="ai-widget-content" id="aiWidgetContent">
                <div class="insights-loading">
                    <div class="loading-skeleton">
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                        <div class="skeleton-item"></div>
                    </div>
                    <p>ƒêang ph√¢n t√≠ch d·ªØ li·ªáu...</p>
                </div>
            </div>
        </div>

        <!-- Main Chart Section -->
        <div class="main-chart-section">
            <div class="main-chart-card">
                <div class="main-chart-header">
                    <div class="main-chart-info">
                        <h2 class="main-chart-title">üìä T∆∞∆°ng quan kh√°ch h√†ng - ƒë∆°n h√†ng</h2>
                        <p class="main-chart-subtitle">M·ªëi quan h·ªá gi·ªØa s·ªë l∆∞·ª£ng kh√°ch h√†ng v√† ƒë∆°n h√†ng theo th·ªùi gian</p>
                    </div>
                    <div class="main-chart-controls">
                        <div class="chart-legend">
                            <div class="legend-item">
                                <div class="legend-color customers-color"></div>
                                <span>Kh√°ch h√†ng</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color orders-color"></div>
                                <span>ƒê∆°n h√†ng</span>
                            </div>
                        </div>
                        <div class="main-chart-filters">
                            <button class="main-filter-btn active" data-period="7">7 ng√†y</button>
                            <button class="main-filter-btn" data-period="30">30 ng√†y</button>
                            <button class="main-filter-btn" data-period="90">3 th√°ng</button>
                        </div>
                    </div>
                </div>
                <div class="main-chart-content">
                    <canvas id="mainOverviewChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Charts Section - 2 Essential Charts -->
        <div class="charts-grid">
            <!-- Revenue Trend Chart -->
            <div class="chart-card slide-up" style="animation-delay: 0.1s;">
                <div class="chart-header">
                    <h3 class="chart-title">üí∞ Xu h∆∞·ªõng doanh thu</h3>
                    <div class="chart-value" id="revenueValue" th:text="${revenueTrend.currentValue != null ? #numbers.formatCurrency(revenueTrend.currentValue) : '0 ‚Ç´'}">32M ‚Ç´</div>
                </div>
                <div class="chart-description">
                    <p class="chart-subtitle">Xu h∆∞·ªõng tƒÉng tr∆∞·ªüng doanh thu 7 ng√†y g·∫ßn ƒë√¢y</p>
                    <div class="chart-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #10b981;"></div>
                            <span>Doanh thu</span>
                        </div>
                    </div>
                </div>
                <div class="chart-content">
                    <canvas id="sideRevenueChart"></canvas>
                </div>
            </div>

            <!-- Orders Status Chart -->
            <div class="chart-card slide-up" style="animation-delay: 0.2s;">
                <div class="chart-header">
                    <h3 class="chart-title">üìä Tr·∫°ng th√°i ƒë∆°n h√†ng</h3>
                    <div class="chart-value" id="statusValue" th:text="${(orderStatusChart.completed ?: 0) + (orderStatusChart.processing ?: 0) + (orderStatusChart.pending ?: 0) + ' ƒë∆°n'}">95 ƒë∆°n</div>
                </div>
                <div class="chart-description">
                    <p class="chart-subtitle">Ph√¢n b·ªë tr·∫°ng th√°i ƒë∆°n h√†ng theo t·ª∑ l·ªá ph·∫ßn trƒÉm</p>
                    <div class="chart-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #10b981;"></div>
                            <span>Ho√†n th√†nh</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #3b82f6;"></div>
                            <span>ƒêang x·ª≠ l√Ω</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #f59e0b;"></div>
                            <span>Ch·ªù x·ª≠ l√Ω</span>
                        </div>
                    </div>
                </div>
                <div class="chart-content">
                    <canvas id="sideOrdersStatusChart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Statistics Section - 2 Essential Stats -->
        <div class="content-grid">
            <!-- Recent Orders -->
            <div class="chart-card slide-up" style="animation-delay: 0.8s;">
                <div class="chart-header">
                    <h3 class="chart-title">üõçÔ∏è ƒê∆°n h√†ng g·∫ßn ƒë√¢y</h3>
                    <a href="/admin/orders" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white text-sm font-medium rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                        Xem t·∫•t c·∫£ <i class="fas fa-arrow-right ml-2"></i>
                    </a>
                </div>
                <div class="space-y-4">
                    <!-- Recent Orders from Backend -->
                    <div th:if="${stats.recentOrders != null and !#lists.isEmpty(stats.recentOrders)}">
                        <div th:each="order : ${stats.recentOrders}" 
                             class="recent-item">
                            <div class="recent-item-avatar bg-gradient-to-br from-blue-400 to-purple-500">
                                <i class="fas fa-shopping-bag text-white text-lg"></i>
                            </div>
                            <div class="recent-item-content">
                                <h4 class="recent-item-title" th:text="'ORDER-' + ${order.id}">ORDER-001</h4>
                                <p class="recent-item-subtitle" th:text="${order.user != null ? order.user.fullName : 'N/A'}">Customer Name</p>
                            </div>
                            <div class="recent-item-meta">
                                <p class="recent-item-value" th:text="${#numbers.formatCurrency(order.totalAmount)}">0‚Ç´</p>
                                <span th:class="${'status-badge ' + 
                                    (order.status.name() == 'COMPLETED' ? 'completed' : 
                                     order.status.name() == 'PENDING' ? 'pending' :
                                     order.status.name() == 'PROCESSING' ? 'processing' :
                                     'cancelled')}"
                                      th:text="${order.status.getDisplayName()}">
                                    Status
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- No orders message -->
                    <div th:if="${stats.recentOrders == null or #lists.isEmpty(stats.recentOrders)}" 
                         class="text-center py-12">
                        <div class="w-16 h-16 bg-gradient-to-br from-gray-100 to-gray-200 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-shopping-cart text-2xl text-gray-400"></i>
                        </div>
                        <p class="text-gray-500 font-medium">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</p>
                        <p class="text-sm text-gray-400 mt-1">ƒê∆°n h√†ng m·ªõi s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y</p>
                    </div>
                </div>
            </div>
            
            <!-- Top Products -->
            <div class="chart-card slide-up" style="animation-delay: 0.9s;">
                <div class="chart-header">
                    <h3 class="chart-title">üåü S·∫£n ph·∫©m b√°n ch·∫°y</h3>
                    <a href="/admin/products" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-emerald-500 to-teal-600 text-white text-sm font-medium rounded-lg hover:from-emerald-600 hover:to-teal-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                        Xem t·∫•t c·∫£ <i class="fas fa-arrow-right ml-2"></i>
                    </a>
                </div>
                <div class="space-y-4">
                    <!-- Product Item -->
                    <div class="recent-item">
                        <div class="recent-item-avatar bg-gradient-to-br from-rose-400 to-pink-500">
                            <span class="text-white text-lg">üåπ</span>
                        </div>
                        <div class="recent-item-content">
                            <h4 class="recent-item-title">Hoa h·ªìng ƒë·ªè</h4>
                            <p class="recent-item-subtitle">ƒê√£ b√°n: 156 s·∫£n ph·∫©m</p>
                        </div>
                        <div class="recent-item-meta">
                            <p class="recent-item-value">450,000‚Ç´</p>
                            <div class="flex items-center mt-1">
                                <div class="progress-bar w-16 mr-2">
                                    <div class="progress-fill" style="width: 85%"></div>
                                </div>
                                <span class="text-xs text-gray-500 font-medium">85%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recent-item">
                        <div class="recent-item-avatar bg-gradient-to-br from-yellow-400 to-orange-500">
                            <span class="text-white text-lg">üåª</span>
                        </div>
                        <div class="recent-item-content">
                            <h4 class="recent-item-title">Hoa h∆∞·ªõng d∆∞∆°ng</h4>
                            <p class="recent-item-subtitle">ƒê√£ b√°n: 134 s·∫£n ph·∫©m</p>
                        </div>
                        <div class="recent-item-meta">
                            <p class="recent-item-value">320,000‚Ç´</p>
                            <div class="flex items-center mt-1">
                                <div class="progress-bar w-16 mr-2">
                                    <div class="progress-fill" style="width: 72%"></div>
                                </div>
                                <span class="text-xs text-gray-500 font-medium">72%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="recent-item">
                        <div class="recent-item-avatar bg-gradient-to-br from-purple-400 to-indigo-500">
                            <span class="text-white text-lg">üå∑</span>
                        </div>
                        <div class="recent-item-content">
                            <h4 class="recent-item-title">Hoa tulip</h4>
                            <p class="recent-item-subtitle">ƒê√£ b√°n: 98 s·∫£n ph·∫©m</p>
                        </div>
                        <div class="recent-item-meta">
                            <p class="recent-item-value">280,000‚Ç´</p>
                            <div class="flex items-center mt-1">
                                <div class="progress-bar w-16 mr-2">
                                    <div class="progress-fill" style="width: 58%"></div>
                                </div>
                                <span class="text-xs text-gray-500 font-medium">58%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- AI Insights Script -->
    <script th:src="@{/js/admin-ai-insights.js}"></script>
    
    <!-- Modern Chart.js Scripts -->
    <script th:inline="javascript">
        // Get data from backend
        const revenueChartData = /*[[${revenueChart}]]*/ {};
        const orderStatusChartData = /*[[${orderStatusChart}]]*/ {};
        
        // Modern Chart Configuration
        Chart.defaults.font.family = "'Inter', 'system-ui', sans-serif";
        Chart.defaults.color = '#6b7280';
        
        // Advanced gradient creator
        const createGradient = (ctx, color1, color2, direction = 'vertical') => {
            const gradient = direction === 'vertical' 
                ? ctx.createLinearGradient(0, 0, 0, 400)
                : ctx.createLinearGradient(0, 0, 400, 0);
            gradient.addColorStop(0, color1);
            gradient.addColorStop(1, color2);
            return gradient;
        };

        // Get real data from backend
        const dashboardData = {
            labels: /*[[${correlationChart.labels}]]*/ ['1/10', '2/10', '3/10', '4/10', '5/10', '6/10', '7/10'],
            revenue: /*[[${correlationChart.revenue}]]*/ [15000000, 18000000, 22000000, 19000000, 25000000, 28000000, 32000000],
            orders: /*[[${correlationChart.orders}]]*/ [45, 52, 68, 58, 75, 82, 95],
            customers: /*[[${correlationChart.customers}]]*/ [12, 15, 18, 16, 22, 25, 28]
        };

        // Revenue trend data for side chart
        const revenueTrendData = {
            labels: /*[[${revenueTrend.labels}]]*/ ['1/10', '2/10', '3/10', '4/10', '5/10', '6/10', '7/10'],
            revenue: /*[[${revenueTrend.revenue}]]*/ [15000000, 18000000, 22000000, 19000000, 25000000, 28000000, 32000000]
        };

        // Order status data for side chart
        const orderStatusData = {
            completed: /*[[${orderStatusChart.completed}]]*/ 65,
            processing: /*[[${orderStatusChart.processing}]]*/ 25,
            pending: /*[[${orderStatusChart.pending}]]*/ 10,
            shipped: /*[[${orderStatusChart.shipped}]]*/ 0,
            cancelled: /*[[${orderStatusChart.cancelled}]]*/ 0
        };

        // Main Correlation Chart - Customers vs Orders
        const mainOverviewCanvas = document.getElementById('mainOverviewChart');
        if (mainOverviewCanvas) {
        const mainOverviewCtx = mainOverviewCanvas.getContext('2d');
        const customersGradient = createGradient(mainOverviewCtx, 'rgba(139, 92, 246, 0.3)', 'rgba(139, 92, 246, 0.05)');
        const ordersGradient = createGradient(mainOverviewCtx, 'rgba(245, 158, 11, 0.3)', 'rgba(245, 158, 11, 0.05)');
        
        new Chart(mainOverviewCtx, {
            type: 'line',
            data: {
                labels: dashboardData.labels,
                datasets: [
                    {
                        label: 'Kh√°ch h√†ng',
                        data: dashboardData.customers,
                        borderColor: '#8b5cf6',
                        backgroundColor: customersGradient,
                        borderWidth: 4,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#ffffff',
                        pointBorderColor: '#8b5cf6',
                        pointBorderWidth: 3,
                        pointRadius: 8,
                        pointHoverRadius: 12,
                        pointHoverBackgroundColor: '#8b5cf6',
                        pointHoverBorderColor: '#ffffff',
                        pointHoverBorderWidth: 4,
                        yAxisID: 'y'
                    },
                    {
                        label: 'ƒê∆°n h√†ng',
                        data: dashboardData.orders,
                        borderColor: '#f59e0b',
                        backgroundColor: ordersGradient,
                        borderWidth: 4,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#ffffff',
                        pointBorderColor: '#f59e0b',
                        pointBorderWidth: 3,
                        pointRadius: 8,
                        pointHoverRadius: 12,
                        pointHoverBackgroundColor: '#f59e0b',
                        pointHoverBorderColor: '#ffffff',
                        pointHoverBorderWidth: 4,
                        yAxisID: 'y1'
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.95)',
                        titleColor: '#f8fafc',
                        bodyColor: '#cbd5e1',
                        borderColor: 'rgba(255, 255, 255, 0.2)',
                        borderWidth: 1,
                        cornerRadius: 12,
                        displayColors: true,
                        padding: 16,
                        titleFont: { size: 16, weight: '700' },
                        bodyFont: { size: 14, weight: '500' },
                        callbacks: {
                            title: function(context) {
                                return 'Ng√†y ' + context[0].label;
                            },
                            label: function(context) {
                                if (context.datasetIndex === 0) {
                                    return 'Kh√°ch h√†ng: ' + context.parsed.y + ' ng∆∞·ªùi';
                                } else {
                                    return 'ƒê∆°n h√†ng: ' + context.parsed.y + ' ƒë∆°n';
                                }
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        border: { display: false },
                        grid: { display: false },
                        ticks: {
                            color: '#6b7280',
                            font: { size: 12, weight: '600' },
                            padding: 10
                        }
                    },
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        beginAtZero: true,
                        border: { display: false },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)',
                            drawBorder: false,
                            lineWidth: 1
                        },
                        ticks: {
                            color: '#6b7280',
                            font: { size: 11, weight: '500' },
                            padding: 10,
                            callback: function(value) {
                                return value + ' ng∆∞·ªùi';
                            }
                        }
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        beginAtZero: true,
                        border: { display: false },
                        grid: {
                            drawOnChartArea: false,
                        },
                        ticks: {
                            color: '#6b7280',
                            font: { size: 11, weight: '500' },
                            padding: 10,
                            callback: function(value) {
                                return value + ' ƒë∆°n';
                            }
                        }
                    }
                },
                interaction: {
                    intersect: false,
                    mode: 'index'
                },
                animation: {
                    duration: 2500,
                    easing: 'easeOutQuart'
                }
            }
        });
        }

        // Side Revenue Chart - Small Line Chart
        const sideRevenueCanvas = document.getElementById('sideRevenueChart');
        if (sideRevenueCanvas) {
        const sideRevenueCtx = sideRevenueCanvas.getContext('2d');
        new Chart(sideRevenueCtx, {
            type: 'line',
            data: {
                labels: revenueTrendData.labels,
                datasets: [{
                    data: revenueTrendData.revenue,
                    borderColor: '#10b981',
                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 0,
                    pointHoverRadius: 6
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { 
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.95)',
                        titleColor: '#f8fafc',
                        bodyColor: '#cbd5e1',
                        borderColor: '#10b981',
                        borderWidth: 2,
                        cornerRadius: 12,
                        displayColors: false,
                        padding: 12,
                        callbacks: {
                            label: function(context) {
                                return 'Doanh thu: ' + new Intl.NumberFormat('vi-VN', {
                                    style: 'currency',
                                    currency: 'VND'
                                }).format(context.parsed.y);
                            }
                        }
                    }
                },
                scales: {
                    x: { 
                        display: true,
                        border: { display: false },
                        grid: { display: false },
                        ticks: {
                            color: '#6b7280',
                            font: { size: 10, weight: '500' },
                            maxTicksLimit: 4
                        }
                    },
                    y: { 
                        display: true,
                        border: { display: false },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)',
                            drawBorder: false
                        },
                        ticks: {
                            color: '#6b7280',
                            font: { size: 10, weight: '500' },
                            maxTicksLimit: 4,
                            callback: function(value) {
                                return (value / 1000000).toFixed(0) + 'M';
                            }
                        }
                    }
                },
                elements: { point: { hoverRadius: 6 } }
            }
        });
        }

        // Side Orders Status Chart - Doughnut
        const sideOrdersStatusCanvas = document.getElementById('sideOrdersStatusChart');
        if (sideOrdersStatusCanvas) {
        const sideOrdersStatusCtx = sideOrdersStatusCanvas.getContext('2d');
        new Chart(sideOrdersStatusCtx, {
            type: 'doughnut',
            data: {
                labels: ['Ho√†n th√†nh', 'ƒêang x·ª≠ l√Ω', 'Ch·ªù x·ª≠ l√Ω'],
                datasets: [{
                    data: [orderStatusData.completed, orderStatusData.processing, orderStatusData.pending],
                    backgroundColor: [
                        '#10b981',
                        '#3b82f6', 
                        '#f59e0b'
                    ],
                    borderWidth: 0,
                    cutout: '70%'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        backgroundColor: 'rgba(15, 23, 42, 0.95)',
                        titleColor: '#f8fafc',
                        bodyColor: '#cbd5e1',
                        borderColor: 'rgba(99, 102, 241, 0.3)',
                        borderWidth: 2,
                        cornerRadius: 12,
                        displayColors: true,
                        padding: 12,
                        callbacks: {
                            label: function(context) {
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((context.parsed * 100) / total).toFixed(1);
                                return context.label + ': ' + context.parsed + ' ƒë∆°n (' + percentage + '%)';
                            }
                        }
                    }
                }
            }
        });
        }

        // Side Top Products Chart - Bar
        const sideTopProductsCanvas = document.getElementById('sideTopProductsChart');
        if (sideTopProductsCanvas) {
        const sideTopProductsCtx = sideTopProductsCanvas.getContext('2d');
        new Chart(sideTopProductsCtx, {
            type: 'bar',
            data: {
                labels: ['Hoa h·ªìng', 'Hoa tulip', 'Hoa ly'],
                datasets: [{
                    data: [156, 89, 67],
                    backgroundColor: [
                        'rgba(236, 72, 153, 0.8)',
                        'rgba(168, 85, 247, 0.8)',
                        'rgba(59, 130, 246, 0.8)'
                    ],
                    borderRadius: 6,
                    borderSkipped: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { display: false },
                    y: { display: false }
                }
            }
        });
        }



        // Interactive filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from siblings
                this.parentNode.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                // Add active class to clicked button
                this.classList.add('active');
            });
        });

        // Main chart filter buttons
        document.querySelectorAll('.main-filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                // Remove active class from siblings
                this.parentNode.querySelectorAll('.main-filter-btn').forEach(b => b.classList.remove('active'));
                // Add active class to clicked button
                this.classList.add('active');
                
                // Get period from data attribute
                const period = parseInt(this.dataset.period);
                
                // Update chart data based on period
                updateMainChart(period);
            });
        });

        // Function to update main chart with new data from backend
        function updateMainChart(period) {
            // Show loading state
            const loadingElement = document.createElement('div');
            loadingElement.innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i...</div>';
            loadingElement.className = 'loading-overlay';
            
            // Fetch new data from backend
            fetch(`/admin/api/correlation-data?period=${period}`)
                .then(response => response.json())
                .then(data => {
                    // Update main correlation chart
                    const mainChart = Chart.getChart('mainOverviewChart');
                    if (mainChart) {
                        mainChart.data.labels = data.labels;
                        mainChart.data.datasets[0].data = data.customers;
                        mainChart.data.datasets[1].data = data.orders;
                        mainChart.update('active');
                    }
                })
                .catch(error => {
                    console.error('Error updating chart:', error);
                    // Show error message
                    alert('C√≥ l·ªói x·∫£y ra khi t·∫£i d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i.');
                });

            // Also update revenue trend chart
            fetch(`/admin/api/revenue-trend?period=${period}`)
                .then(response => response.json())
                .then(data => {
                    const revenueChart = Chart.getChart('sideRevenueChart');
                    if (revenueChart) {
                        revenueChart.data.labels = data.labels;
                        revenueChart.data.datasets[0].data = data.revenue;
                        revenueChart.update('active');
                    }
                    
                    // Update revenue value display
                    const revenueValue = document.getElementById('revenueValue');
                    if (revenueValue && data.currentValue) {
                        const formattedValue = new Intl.NumberFormat('vi-VN', {
                            style: 'currency',
                            currency: 'VND',
                            minimumFractionDigits: 0,
                            maximumFractionDigits: 0
                        }).format(data.currentValue);
                        revenueValue.textContent = formattedValue.replace('‚Ç´', ' ‚Ç´');
                    }
                })
                .catch(error => {
                    console.error('Error updating revenue trend:', error);
                });
        }
        
        // Initialize AI Insights with lazy loading
        document.addEventListener('DOMContentLoaded', function() {
            if (document.getElementById('aiInsightsWidget')) {
                setTimeout(loadAiInsights, 500);
            }
        });
    </script>
    </div>
    </div>
</body>

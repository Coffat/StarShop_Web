<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" th:replace="~{layouts/main :: layout(${pageTitle}, 
          ${pageDescription}, 
          ~{::link},
          ~{::content})}">

<head>
    <link rel="stylesheet" href="/css/products.css">
</head>

<body>
    <th:block th:fragment="content">

        <div th:if="${product eq null}" class="product-not-found-container container py-5 my-5 text-center">
            <h2 class="text-danger mb-3">404 - Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m!</h2>
            <p class="mb-4">S·∫£n ph·∫©m b·∫°n ƒëang t√¨m ki·∫øm kh√¥ng t·ªìn t·∫°i ho·∫∑c ƒë√£ b·ªã x√≥a.</p>
            <a th:href="@{/products}" class="btn btn-primary px-4 py-2">
                <svg class="w-5 h-5 inline-block me-1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                    fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M9.293 2.293a1 1 0 0 1 1.414 0l7 7A1 1 0 0 1 17 11h-1v6a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-6H3a1 1 0 0 1-.707-1.707l7-7Z"
                        clip-rule="evenodd" />
                </svg>
                V·ªÅ trang danh s√°ch s·∫£n ph·∫©m
            </a>
        </div>

        <div th:if="${product ne null}">
            <nav aria-label="breadcrumb" class="breadcrumb-nav">
                <div class="container">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="/home" class="breadcrumb-link">
                                <svg class="w-4 h-4 inline-block" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                    fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M9.293 2.293a1 1 0 0 1 1.414 0l7 7A1 1 0 0 1 17 11h-1v6a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-3a1 1 0 0 0-1-1H9a1 1 0 0 0-1 1v3a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-6H3a1 1 0 0 1-.707-1.707l7-7Z"
                                        clip-rule="evenodd" />
                                </svg>
                                Trang ch·ªß
                            </a>
                        </li>
                        <li class="breadcrumb-item">
                            <a href="/products" class="breadcrumb-link">S·∫£n ph·∫©m</a>
                        </li>
                        <li class="breadcrumb-item active" aria-current="page">
                            <span th:text="${product.name}">T√™n s·∫£n ph·∫©m</span>
                        </li>
                    </ol>
                </div>
            </nav>

            <section class="product-detail-section">
                <div class="container">
                    <div class="product-detail-container">
                        <!-- C·ªôt h√¨nh ·∫£nh (b√™n tr√°i) -->
                        <div class="product-images">
                            <div class="main-image-container">
                                <img th:src="${product.image ne null ? product.image : '/images/products/default-flower.jpg'}"
                                    th:alt="${product.name}" th:title="${product.name}" class="main-image"
                                    id="mainProductImage">

                                <div class="image-zoom-overlay" id="imageZoomOverlay">
                                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                        fill="currentColor">
                                        <path
                                            d="M9 6a.75.75 0 0 1 .75.75v1.5h1.5a.75.75 0 0 1 0 1.5h-1.5v1.5a.75.75 0 0 1-1.5 0v-1.5h-1.5a.75.75 0 0 1 0-1.5h1.5v-1.5A.75.75 0 0 1 9 6Z" />
                                        <path fill-rule="evenodd"
                                            d="M2 9a7 7 0 1 1 12.452 4.391l3.328 3.329a.75.75 0 1 1-1.06 1.06l-3.329-3.328A7 7 0 0 1 2 9Zm7-5.5a5.5 5.5 0 1 0 0 11 5.5 5.5 0 0 0 0-11Z"
                                            clip-rule="evenodd" />
                                    </svg>
                                </div>
                            </div>

                            <div class="thumbnail-images">
                                <div class="thumbnail-item active">
                                    <img th:src="${product.image ne null ? product.image : '/images/products/default-flower.jpg'}"
                                        th:alt="${product.name}" th:title="${product.name}" class="thumbnail-image">
                                </div>
                            </div>
                        </div>

                        <!-- C·ªôt th√¥ng tin (b√™n ph·∫£i) -->
                        <div class="product-info">
                            <div class="product-header">
                                <h1 class="product-title" th:text="${product.name}">T√™n s·∫£n ph·∫©m</h1>

                                <div class="product-rating-section">
                                    <div class="rating-display">
                                        <div class="rating-stars">
                                            <th:block th:each="star : ${#numbers.sequence(1, 5)}">
                                                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg"
                                                    viewBox="0 0 20 20" fill="currentColor"
                                                    th:classappend="${averageRating ne null and star le averageRating ? 'filled' : 'empty'}">
                                                    <path fill-rule="evenodd"
                                                        d="M10.868 2.884c-.321-.772-1.415-.772-1.736 0l-1.83 4.401-4.753.381c-.833.067-1.171 1.107-.536 1.651l3.62 3.102-1.106 4.637c-.194.813.691 1.456 1.405 1.02L10 15.591l4.069 2.485c.713.436 1.598-.207 1.404-1.02l-1.106-4.637 3.62-3.102c.635-.544.297-1.584-.536-1.65l-4.752-.382-1.831-4.401Z"
                                                        clip-rule="evenodd" />
                                                </svg>
                                            </th:block>
                                        </div>
                                        <span class="rating-score"
                                            th:text="${averageRating ne null ? #numbers.formatDecimal(averageRating, 1, 1) : '0.0'}">0.0</span>
                                        <span class="rating-count">
                                            (<span th:text="${reviewCount ne null ? reviewCount : 0}">0</span> ƒë√°nh gi√°)
                                        </span>
                                    </div>
                                </div>
                            </div>

                            <div class="product-price-section">
                                <div class="price-display">
                                    <span class="current-price"
                                        th:text="${#numbers.formatCurrency(product.price)}">0‚Ç´</span>
                                </div>
                            </div>

                            <div class="product-description" th:if="${product.description ne null}">
                                <h3 class="description-title">M√¥ t·∫£ s·∫£n ph·∫©m</h3>
                                <div class="description-content" th:utext="${product.description}">
                                    M√¥ t·∫£ s·∫£n ph·∫©m s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y...
                                </div>
                            </div>

                            <!--/*
                        <div class="product-attributes" th:if="${product.attributeValues ne null and not #lists.isEmpty(product.attributeValues)}">
                            <h3 class="attributes-title">Th√¥ng tin chi ti·∫øt</h3>
                            <div class="attributes-list">
                                <div th:each="attr : ${product.attributeValues}" class="attribute-item">
                                    <span class="attribute-name" th:text="${attr.attribute.name}">Thu·ªôc t√≠nh</span>:
                                    <span class="attribute-value" th:text="${attr.value}">Gi√° tr·ªã</span>
                                </div>
                            </div>
                        </div>
                        */-->
<!-- 
                            <div class="add-to-cart-section">
                                <div class="quantity-selector">
                                    <label for="quantity" class="quantity-label">S·ªë l∆∞·ª£ng:</label>
                                    <div class="quantity-input-group">
                                        <button type="button" class="btn-quantity-decrease"
                                            onclick="decreaseQuantity()">
                                            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                                fill="currentColor">
                                                <path fill-rule="evenodd"
                                                    d="M4 10a.75.75 0 0 1 .75-.75h10.5a.75.75 0 0 1 0 1.5H4.75A.75.75 0 0 1 4 10Z"
                                                    clip-rule="evenodd" />
                                            </svg>
                                        </button>
                                        <input type="number" id="quantity" class="quantity-input" value="1" min="1"
                                            max="99">
                                        <button type="button" class="btn-quantity-increase"
                                            onclick="increaseQuantity()">
                                            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"
                                                fill="currentColor">
                                                <path
                                                    d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>

                                <div class="action-buttons">
                                    <button class="btn-add-to-cart primary" th:data-product-id="${product.id}"
                                        sec:authorize="isAuthenticated()">
                                        <svg class="w-5 h-5 inline-block" xmlns="http://www.w3.org/2000/svg"
                                            viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd"
                                                d="M6 5v1H4.667a1.75 1.75 0 0 0-1.743 1.598l-.826 9.5A1.75 1.75 0 0 0 3.84 19h12.32a1.75 1.75 0 0 0 1.742-1.902l-.826-9.5A1.75 1.75 0 0 0 15.333 6H14V5a4 4 0 0 0-8 0Zm4-2.5A2.5 2.5 0 0 0 7.5 5v1h5V5A2.5 2.5 0 0 0 10 2.5Z"
                                                clip-rule="evenodd" />
                                        </svg>
                                        Th√™m v√†o gi·ªè h√†ng
                                    </button>
                                    

                                    <button class="btn-buy-now" th:data-product-id="${product.id}"
                                        onclick="buyNow(this)" sec:authorize="isAuthenticated()">
                                        <svg class="w-5 h-5 inline-block" xmlns="http://www.w3.org/2000/svg"
                                            viewBox="0 0 20 20" fill="currentColor">
                                            <path
                                                d="M11.983 1.907a.75.75 0 0 0-1.292-.657l-8.5 9.5A.75.75 0 0 0 2.75 12h6.572l-1.305 6.093a.75.75 0 0 0 1.292.657l8.5-9.5A.75.75 0 0 0 17.25 8h-6.572l1.305-6.093Z" />
                                        </svg>
                                        Mua ngay
                                    </button>

                                    <a th:href="@{/login}" class="btn-add-to-cart primary btn-login-required"
                                        sec:authorize="!isAuthenticated()">
                                        <svg class="w-5 h-5 inline-block" xmlns="http://www.w3.org/2000/svg"
                                            viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd"
                                                d="M3 4.25A2.25 2.25 0 0 1 5.25 2h5.5A2.25 2.25 0 0 1 13 4.25v2a.75.75 0 0 1-1.5 0v-2a.75.75 0 0 0-.75-.75h-5.5a.75.75 0 0 0-.75.75v11.5c0 .414.336.75.75.75h5.5a.75.75 0 0 0 .75-.75v-2a.75.75 0 0 1 1.5 0v2A2.25 2.25 0 0 1 10.75 18h-5.5A2.25 2.25 0 0 1 3 15.75V4.25Z"
                                                clip-rule="evenodd" />
                                            <path fill-rule="evenodd"
                                                d="M19 10a.75.75 0 0 0-.75-.75H8.704l1.048-.943a.75.75 0 1 0-1.004-1.114l-2.5 2.25a.75.75 0 0 0 0 1.114l2.5 2.25a.75.75 0 1 0 1.004-1.114L8.704 10.75H18.25A.75.75 0 0 0 19 10Z"
                                                clip-rule="evenodd" />
                                        </svg>
                                        ƒêƒÉng nh·∫≠p ƒë·ªÉ mua h√†ng
                                    </a>
                                </div>

                                <button class="btn btn-wishlist"
                                    th:data-product-id="${product.id}"
                                    th:classappend="${isInWishlist} ? 'active'" sec:authorize="isAuthenticated()"
                                    >
                                    <i th:if="${isInWishlist}" class="fa-solid fa-heart"></i>
                                    <i th:unless="${isInWishlist}" class="fa-regular fa-heart"></i>
                                </button>
                            </div> -->

                            <!-- Ph·∫ßn h√†nh ƒë·ªông ch√≠nh -->
                            <div class="add-to-cart-section">
                                <!-- B·ªô ch·ªçn s·ªë l∆∞·ª£ng -->
                                <div class="quantity-selector">
                                    <label for="quantity" class="quantity-label">S·ªë l∆∞·ª£ng:</label>
                                    <div class="quantity-input-group">
                                        <button type="button" class="btn-quantity-decrease" onclick="decreaseQuantity()">
                                            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M4 10a.75.75 0 0 1 .75-.75h10.5a.75.75 0 0 1 0 1.5H4.75A.75.75 0 0 1 4 10Z" clip-rule="evenodd" />
                                            </svg>
                                        </button>
                                        <input type="number" id="quantity" class="quantity-input" value="1" min="1" max="99">
                                        <button type="button" class="btn-quantity-increase" onclick="increaseQuantity()">
                                            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            
                                <!-- Nh√≥m n√∫t ch√≠nh: Th√™m gi·ªè h√†ng + Y√™u th√≠ch -->
                                <div class="main-action-group" sec:authorize="isAuthenticated()">
                                    <button class="btn-add-to-cart primary" th:data-product-id="${product.id}">
                                        <svg class="w-5 h-5 inline-block" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd" d="M6 5v1H4.667a1.75 1.75 0 0 0-1.743 1.598l-.826 9.5A1.75 1.75 0 0 0 3.84 19h12.32a1.75 1.75 0 0 0 1.742-1.902l-.826-9.5A1.75 1.75 0 0 0 15.333 6H14V5a4 4 0 0 0-8 0Zm4-2.5A2.5 2.5 0 0 0 7.5 5v1h5V5A2.5 2.5 0 0 0 10 2.5Z" clip-rule="evenodd" />
                                        </svg>
                                        Th√™m v√†o gi·ªè h√†ng
                                    </button>

                                    <button class="btn-wishlist"
        th:data-product-id="${product.id}"
        th:classappend="${#sets.contains(wishlistProductIds, product.id)} ? 'active'"
        sec:authorize="isAuthenticated()">
    <i th:if="${#sets.contains(wishlistProductIds, product.id)}" class="fa-solid fa-heart"></i>
    <i th:unless="${#sets.contains(wishlistProductIds, product.id)}" class="fa-regular fa-heart"></i>
</button>
                                    <!-- <button class="btn-wishlist"
                                            th:data-product-id="${product.id}"
                                            th:classappend="${isInWishlist} ? 'active'">
                                        <i th:if="${isInWishlist}" class="fa-solid fa-heart"></i>
                                        <i th:unless="${isInWishlist}" class="fa-regular fa-heart"></i>
                                    </button> -->
                                </div>
                            
                                <!-- N√∫t mua ngay -->
                                <button class="btn-buy-now" th:data-product-id="${product.id}" onclick="buyNow(this)" sec:authorize="isAuthenticated()">
                                    <svg class="w-5 h-5 inline-block" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                        <path d="M11.983 1.907a.75.75 0 0 0-1.292-.657l-8.5 9.5A.75.75 0 0 0 2.75 12h6.572l-1.305 6.093a.75.75 0 0 0 1.292.657l8.5-9.5A.75.75 0 0 0 17.25 8h-6.572l1.305-6.093Z" />
                                    </svg>
                                    Mua ngay
                                </button>
                            
                                <!-- N√∫t ƒëƒÉng nh·∫≠p cho ng∆∞·ªùi d√πng ch∆∞a ƒëƒÉng nh·∫≠p -->
                                <a th:href="@{/login}" class="btn-add-to-cart primary btn-login-required" sec:authorize="!isAuthenticated()">
                                    <svg class="w-5 h-5 inline-block" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M3 4.25A2.25 2.25 0 0 1 5.25 2h5.5A2.25 2.25 0 0 1 13 4.25v2a.75.75 0 0 1-1.5 0v-2a.75.75 0 0 0-.75-.75h-5.5a.75.75 0 0 0-.75.75v11.5c0 .414.336.75.75.75h5.5a.75.75 0 0 0 .75-.75v-2a.75.75 0 0 1 1.5 0v2A2.25 2.25 0 0 1 10.75 18h-5.5A2.25 2.25 0 0 1 3 15.75V4.25Z" clip-rule="evenodd" />
                                        <path fill-rule="evenodd" d="M19 10a.75.75 0 0 0-.75-.75H8.704l1.048-.943a.75.75 0 1 0-1.004-1.114l-2.5 2.25a.75.75 0 0 0 0 1.114l2.5 2.25a.75.75 0 1 0 1.004-1.114L8.704 10.75H18.25A.75.75 0 0 0 19 10Z" clip-rule="evenodd" />
                                    </svg>
                                    ƒêƒÉng nh·∫≠p ƒë·ªÉ mua h√†ng
                                </a>
                            </div>

                            <div class="product-features">
                                <div class="feature-item">
                                    <svg class="feature-icon w-8 h-8" xmlns="http://www.w3.org/2000/svg"
                                        viewBox="0 0 20 20" fill="currentColor">
                                        <path
                                            d="M6.5 3c-1.051 0-2.093.04-3.125.117A1.49 1.49 0 0 0 2 4.607V10.5h9V4.606c0-.771-.59-1.43-1.375-1.489A41.568 41.568 0 0 0 6.5 3ZM2 12v2.5A1.5 1.5 0 0 0 3.5 16h.041a3 3 0 0 1 5.918 0h.791a.75.75 0 0 0 .75-.75V12H2Z" />
                                        <path
                                            d="M6.5 18a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3ZM13.25 5a.75.75 0 0 0-.75.75v8.514a3.001 3.001 0 0 1 4.893 1.44c.37-.275.61-.719.595-1.227a24.905 24.905 0 0 0-1.784-8.549A1.486 1.486 0 0 0 14.823 5H13.25ZM14.5 18a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z" />
                                    </svg>
                                    <div class="feature-content">
                                        <h4 class="feature-title">Giao h√†ng mi·ªÖn ph√≠</h4>
                                        <p class="feature-description">Mi·ªÖn ph√≠ giao h√†ng n·ªôi th√†nh TP.HCM</p>
                                    </div>
                                </div>
                                <div class="feature-item">
                                    <svg class="feature-icon w-8 h-8" xmlns="http://www.w3.org/2000/svg"
                                        viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd"
                                            d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm.75-13a.75.75 0 0 0-1.5 0v5c0 .414.336.75.75.75h4a.75.75 0 0 0 0-1.5h-3.25V5Z"
                                            clip-rule="evenodd" />
                                    </svg>
                                    <div class="feature-content">
                                        <h4 class="feature-title">Giao h√†ng nhanh</h4>
                                        <p class="feature-description">Giao trong 2-4 gi·ªù</p>
                                    </div>
                                </div>
                                <div class="feature-item">
                                    <svg class="feature-icon w-8 h-8" xmlns="http://www.w3.org/2000/svg"
                                        viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd"
                                            d="M5.5 3A2.5 2.5 0 0 0 3 5.5v2.879a2.5 2.5 0 0 0 .732 1.767l6.5 6.5a2.5 2.5 0 0 0 3.536 0l2.878-2.878a2.5 2.5 0 0 0 0-3.536l-6.5-6.5A2.5 2.5 0 0 0 8.38 3H5.5ZM6 7a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"
                                            clip-rule="evenodd" />
                                    </svg>
                                    <div class="feature-content">
                                        <h4 class="feature-title">Hoa t∆∞∆°i 100%</h4>
                                        <p class="feature-description">Cam k·∫øt hoa t∆∞∆°i, ch·∫•t l∆∞·ª£ng cao</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        <section class="product-tabs-section">
            <div class="container">
                <div class="tabs-container">
                    <ul class="nav nav-tabs product-tabs" id="productTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="description-tab" data-bs-toggle="tab" 
                                    data-bs-target="#description" type="button" role="tab" 
                                    aria-controls="description" aria-selected="true">
                                M√¥ t·∫£ chi ti·∫øt
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" 
                                    data-bs-target="#reviews" type="button" role="tab" 
                                    aria-controls="reviews" aria-selected="false">
                                ƒê√°nh gi√° (<span th:text="${reviewCount ne null ? reviewCount : 0}">0</span>)
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="care-tab" data-bs-toggle="tab" 
                                    data-bs-target="#care" type="button" role="tab" 
                                    aria-controls="care" aria-selected="false">
                                H∆∞·ªõng d·∫´n chƒÉm s√≥c
                            </button>
                        </li>
                    </ul>
    
                    <div class="tab-content product-tab-content" id="productTabContent">
                        <div class="tab-pane fade show active" id="description" role="tabpanel" 
                             aria-labelledby="description-tab">
                            <div class="tab-content-wrapper">
                                <div class="description-detail" th:utext="${product.description}">
                                    <p>M√¥ t·∫£ chi ti·∫øt s·∫£n ph·∫©m s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y...</p>
                                </div>
                            </div>
                        </div>
    
                        <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
                            <div class="tab-content-wrapper">
                                <div class="reviews-section">
                                    <div class="reviews-summary">
                                        <div class="rating-overview">
                                            <div class="rating-score-large">
                                                <span class="score" th:text="${averageRating ne null ? #numbers.formatDecimal(averageRating, 1, 1) : '0.0'}">0.0</span>
                                                <div class="stars-large">
                                                    <th:block th:each="star : ${#numbers.sequence(1, 5)}">
                                                        <i class="bi bi-star-fill" 
                                                           th:classappend="${averageRating ne null and star le averageRating ? 'filled' : 'empty'}"></i>
                                                    </th:block>
                                                </div>
                                                <p class="reviews-count" th:text="${reviewCount ne null ? (reviewCount + ' ƒë√°nh gi√°') : '0 ƒë√°nh gi√°'}">0 ƒë√°nh gi√°</p>
                                            </div>
                                        </div>
                                    </div>
    
                                    <div class="reviews-list">
                                        <div th:if="${reviews eq null or #lists.isEmpty(reviews)}" class="no-reviews">
                                            <i class="bi bi-chat-square-text no-reviews-icon"></i>
                                            <h4>Ch∆∞a c√≥ ƒë√°nh gi√° n√†o</h4>
                                            <p>H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n ƒë√°nh gi√° s·∫£n ph·∫©m n√†y!</p>
                                        </div>
    
                                        <div th:each="review : ${reviews}" class="review-item">
                                            <div class="review-header">
                                                <div class="reviewer-info">
                                                    <div class="reviewer-avatar">
                                                        <i class="bi bi-person-circle"></i>
                                                    </div>
                                                    <div class="reviewer-details">
                                                        <div class="flex items-center gap-2">
                                                            <h5 class="reviewer-name" th:text="${review.user.firstname + ' ' + review.user.lastname}">T√™n kh√°ch h√†ng</h5>
                                                            <span th:if="${review.orderItem != null}" class="verified-badge inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-700 text-xs font-medium rounded-full">
                                                                <i class="bi bi-patch-check-fill"></i> ƒê√£ mua h√†ng
                                                            </span>
                                                            <span th:if="${review.sentiment != null}" 
                                                                  th:class="'sentiment-badge ' + ${review.sentiment.toLowerCase()}"
                                                                  th:text="${review.sentiment == 'POSITIVE' ? 'üòä T√≠ch c·ª±c' : (review.sentiment == 'NEGATIVE' ? 'üòû Ti√™u c·ª±c' : 'üòê Trung l·∫≠p')}">
                                                            </span>
                                                        </div>
                                                        <div class="review-rating">
                                                            <th:block th:each="star : ${#numbers.sequence(1, 5)}">
                                                                <i class="bi bi-star-fill" 
                                                                   th:classappend="${star le review.rating ? 'filled' : 'empty'}"></i>
                                                            </th:block>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="flex items-center gap-2">
                                                    <div class="review-date" th:text="${#temporals.format(review.createdAt, 'dd/MM/yyyy')}">
                                                        01/01/2024
                                                    </div>
                                                    <div class="review-actions" 
                                                         sec:authorize="isAuthenticated()"
                                                         th:if="${#authentication.name == review.user.email}">
                                                        <button class="btn-edit-review text-blue-600 hover:text-blue-700 text-sm" 
                                                                th:onclick="'editReview(' + ${review.id} + ')'">
                                                            <i class="bi bi-pencil"></i> S·ª≠a
                                                        </button>
                                                        <button class="btn-delete-review text-red-600 hover:text-red-700 text-sm ml-2" 
                                                                th:onclick="'deleteReview(' + ${review.id} + ')'">
                                                            <i class="bi bi-trash"></i> X√≥a
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="review-content" th:if="${review.comment ne null}">
                                                <p th:text="${review.comment}">N·ªôi dung ƒë√°nh gi√°...</p>
                                            </div>
                                            
                                            <!-- Admin Response -->
                                            <div th:if="${review.adminResponse != null}" class="admin-response mt-3 p-3 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                                                <div class="flex items-center gap-2 mb-2">
                                                    <i class="bi bi-shield-check text-blue-600"></i>
                                                    <span class="font-semibold text-blue-900">Ph·∫£n h·ªìi t·ª´ StarShop</span>
                                                    <span class="text-sm text-gray-500" th:text="${review.adminResponseAt != null ? #temporals.format(review.adminResponseAt, 'dd/MM/yyyy') : ''}"></span>
                                                </div>
                                                <p class="text-gray-700 mb-0" th:text="${review.adminResponse}"></p>
                                            </div>
                                            
                                            <div class="review-helpful mt-3">
                                                <button class="btn-helpful inline-flex items-center gap-1 px-3 py-1.5 bg-gray-100 text-gray-600 text-sm rounded-lg hover:bg-gray-200 transition-colors" 
                                                        th:onclick="'markHelpful(' + ${review.id} + ')'">
                                                    <i class="bi bi-hand-thumbs-up"></i> H·ªØu √≠ch (<span>0</span>)
                                                </button>
                                            </div>
                                        </div>
                                    </div>
    
                                    <div class="write-review-section" sec:authorize="isAuthenticated()">
                                        <div class="text-center p-6 bg-gray-50 rounded-xl">
                                            <i class="bi bi-info-circle text-2xl text-blue-500 mb-3"></i>
                                            <h4 class="text-lg font-semibold text-gray-900 mb-2">Mua s·∫£n ph·∫©m ƒë·ªÉ c√≥ th·ªÉ ƒë√°nh gi√°</h4>
                                            <p class="text-gray-600 mb-4">B·∫°n ch·ªâ c√≥ th·ªÉ ƒë√°nh gi√° s·∫£n ph·∫©m sau khi ƒë√£ mua v√† ƒë∆°n h√†ng ho√†n th√†nh.</p>
                                            <a href="/account/orders" class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white font-medium rounded-xl hover:shadow-lg transition-all">
                                                <i class="bi bi-bag-check"></i>
                                                Xem ƒë∆°n h√†ng c·ªßa t√¥i
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
    
                        <div class="tab-pane fade" id="care" role="tabpanel" aria-labelledby="care-tab">
                            <div class="tab-content-wrapper">
                                <div class="care-guide">
                                    <h4>H∆∞·ªõng d·∫´n chƒÉm s√≥c hoa t∆∞∆°i</h4>
                                    <div class="care-tips">
                                        <div class="care-tip">
                                            <i class="bi bi-droplet care-tip-icon"></i>
                                            <div class="care-tip-content">
                                                <h5>T∆∞·ªõi n∆∞·ªõc ƒë·ªÅu ƒë·∫∑n</h5>
                                                <p>Thay n∆∞·ªõc s·∫°ch m·ªói 2-3 ng√†y, c·∫Øt ch√©o g·ªëc hoa kho·∫£ng 1cm.</p>
                                            </div>
                                        </div>
                                        <div class="care-tip">
                                            <i class="bi bi-sun care-tip-icon"></i>
                                            <div class="care-tip-content">
                                                <h5>Tr√°nh √°nh n·∫Øng tr·ª±c ti·∫øp</h5>
                                                <p>ƒê·∫∑t hoa ·ªü n∆°i tho√°ng m√°t, tr√°nh √°nh n·∫Øng tr·ª±c ti·∫øp v√† gi√≥ m·∫°nh.</p>
                                            </div>
                                        </div>
                                        <div class="care-tip">
                                            <i class="bi bi-thermometer care-tip-icon"></i>
                                            <div class="care-tip-content">
                                                <h5>Nhi·ªát ƒë·ªô ph√π h·ª£p</h5>
                                                <p>Gi·ªØ nhi·ªát ƒë·ªô ph√≤ng t·ª´ 18-22¬∞C ƒë·ªÉ hoa t∆∞∆°i l√¢u h∆°n.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="related-products-section" th:if="${relatedProducts ne null and not #lists.isEmpty(relatedProducts)}">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">S·∫£n ph·∫©m li√™n quan</h2>
                    <p class="section-subtitle">C√°c s·∫£n ph·∫©m t∆∞∆°ng t·ª± c√≥ th·ªÉ b·∫°n quan t√¢m</p>
                </div>
                
                <div class="related-products-grid">
                    <div th:each="relatedProduct : ${relatedProducts}" class="product-card">
                        <div class="product-image-container">
                            <a th:href="@{/products/{id}(id=${relatedProduct.id})}" class="product-image-link">
                                <img th:src="${relatedProduct.image ne null ? relatedProduct.image : '/images/products/default-flower.jpg'}" 
                                     th:alt="${relatedProduct.name}" 
                                     th:title="${relatedProduct.name}"
                                     class="product-image"
                                     loading="lazy">
                            </a>
                        </div>
    
                        <div class="product-content">
                            <h3 class="product-title">
                                <a th:href="@{/products/{id}(id=${relatedProduct.id})}" 
                                   class="product-title-link" 
                                   th:text="${relatedProduct.name}">T√™n s·∫£n ph·∫©m</a>
                            </h3>
                            
                            <div class="product-price">
                                <span class="current-price" th:text="${#numbers.formatCurrency(relatedProduct.price)}">0‚Ç´</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        </div>
    </th:block>

    <style>
        /* Image Modal Styles */
        .image-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
        }

        .image-modal-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .image-modal-content {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            cursor: default;
        }

        .image-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5rem;
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .image-modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>

</body>

</html>
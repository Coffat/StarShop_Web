<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" 
      lang="vi">

<!-- Professional Header Fragment -->
<div th:fragment="header" class="header-wrapper">
    <!-- Top Bar - Logo & User Actions -->
    <div class="top-bar">
        <div class="container">
            <div class="top-bar-content">
                <!-- Left: Logo -->
                <div class="top-logo-section">
                    <a href="/" class="top-logo-link">
                        <span class="logo-text">StarShop</span>
                        <span class="logo-icon heartbeat">üå∏</span>
                    </a>
                </div>

                <!-- Center: Search Bar -->
                <div class="top-bar-search d-none d-lg-flex">
                    <form class="search-form" action="/search" method="GET">
                        <div class="search-input-group">
                            <input type="text" 
                                   class="search-input" 
                                   name="q" 
                                   placeholder="üå∏ T√¨m hoa nhanh - Hoa sinh nh·∫≠t, t√¨nh y√™u, c∆∞·ªõi..."
                                   th:value="${searchQuery}"
                                   autocomplete="off">
                            <button type="submit" class="search-btn">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Right: User Actions & Language -->
                <div class="top-bar-actions">
                    <!-- Language Switcher -->
                    <div class="dropdown">
                        <button class="btn-language dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-globe"></i>
                            <span>VI</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li>
                                <a class="dropdown-item active" href="#" data-lang="vi">
                                    <img src="https://flagcdn.com/w20/vn.png" alt="Ti·∫øng Vi·ªát" class="flag-icon">
                                    Ti·∫øng Vi·ªát
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#" data-lang="en">
                                    <img src="https://flagcdn.com/w20/us.png" alt="English" class="flag-icon">
                                    English
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- Auth Links (Not logged in) -->
                    <div class="auth-actions" th:if="${!isUserAuthenticated}">
                        <a href="/login" class="auth-link">
                            <i class="bi bi-box-arrow-in-right"></i>
                            <span>ƒêƒÉng nh·∫≠p</span>
                        </a>
                        <a href="/register" class="auth-link register">
                            <i class="bi bi-person-plus"></i>
                            <span>ƒêƒÉng k√Ω</span>
                        </a>
                    </div>

                    <!-- User Menu (Logged in) -->
                    <div class="dropdown" th:if="${isUserAuthenticated}">
                        <button class="btn-user dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <img th:if="${userObject != null and userObject.avatar != null}" 
                                 th:src="${userObject.avatar}" 
                                 alt="Avatar" 
                                 class="user-avatar-img" 
                                 style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover; margin-right: 8px;"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-block';">
                            <i th:if="${userObject == null or userObject.avatar == null}" class="bi bi-person-circle" style="display: inline-block;"></i>
                            <i class="bi bi-person-circle" style="display: none;"></i>
                            <span th:text="${userObject != null ? userObject.fullName : currentUser}">User</span>
                            <i class="bi bi-chevron-down"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end user-dropdown">
                            <li class="dropdown-header">
                                <img th:if="${userObject != null and userObject.avatar != null}" 
                                     th:src="${userObject.avatar}" 
                                     alt="Avatar" 
                                     style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; margin-right: 12px;"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-block';">
                                <i th:if="${userObject == null or userObject.avatar == null}" class="bi bi-person-circle" style="display: inline-block;"></i>
                                <i class="bi bi-person-circle" style="display: none;"></i>
                                <div>
                                    <div class="user-name" th:text="${userObject != null ? userObject.fullName : currentUser}">User</div>
                                    <small class="user-email" th:text="${userObject != null ? userObject.email : currentUser}">user@email.com</small>
                                </div>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/account/profile">
                                <i class="bi bi-person"></i> Th√¥ng tin c√° nh√¢n
                            </a></li>
                            <li><a class="dropdown-item" href="/account/orders">
                                <i class="bi bi-bag"></i> ƒê∆°n h√†ng c·ªßa t√¥i
                            </a></li>
                            <li><a class="dropdown-item" href="/wishlist">
                                <i class="bi bi-heart"></i> Danh s√°ch y√™u th√≠ch
                            </a></li>
                            <li><a class="dropdown-item" href="/account/settings">
                                <i class="bi bi-gear"></i> C√†i ƒë·∫∑t
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <!-- Desktop Logout -->
                            <li>
                                <a href="/logout" class="dropdown-item text-danger" onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')">
                                    <i class="bi bi-box-arrow-right"></i> ƒêƒÉng xu·∫•t
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Header - Logo, Navigation & Actions -->
    <header class="main-header">
        <div class="container">
            <div class="main-header-content">
                <!-- Navigation Section -->
                <div class="nav-section">
                    <!-- Navigation Menu -->
                    <nav class="header-nav d-none d-lg-flex">
                        <ul class="nav-menu">
                            <li class="nav-item">
                                <a href="/" class="nav-link" th:classappend="${currentPath == '/' ? 'active' : ''}">
                                    <i class="bi bi-house"></i>
                                    <span>Trang ch·ªß</span>
                                </a>
                            </li>
                            <li class="nav-item dropdown-hover">
                                <a href="/categories" class="nav-link">
                                    <i class="bi bi-grid"></i>
                                    <span>Danh m·ª•c hoa</span>
                                    <i class="bi bi-chevron-down dropdown-arrow"></i>
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="/categories/sinh-nhat">
                                        <i class="bi bi-gift"></i> Hoa sinh nh·∫≠t
                                    </a></li>
                                    <li><a class="dropdown-item" href="/categories/tinh-yeu">
                                        <i class="bi bi-heart"></i> Hoa t√¨nh y√™u
                                    </a></li>
                                    <li><a class="dropdown-item" href="/categories/cuoi">
                                        <i class="bi bi-suit-heart"></i> Hoa c∆∞·ªõi
                                    </a></li>
                                    <li><a class="dropdown-item" href="/categories/khai-truong">
                                        <i class="bi bi-star"></i> Hoa khai tr∆∞∆°ng
                                    </a></li>
                                    <li><a class="dropdown-item" href="/categories/chia-buon">
                                        <i class="bi bi-flower1"></i> Hoa chia bu·ªìn
                                    </a></li>
                                    <li><a class="dropdown-item" href="/categories/tang-me">
                                        <i class="bi bi-heart-fill"></i> Hoa t·∫∑ng m·∫π
                                    </a></li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a href="/products" class="nav-link" th:classappend="${#strings.startsWith(currentPath, '/products') ? 'active' : ''}">
                                    <i class="bi bi-flower2"></i>
                                    <span>S·∫£n ph·∫©m</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/gifts" class="nav-link" th:classappend="${#strings.startsWith(currentPath, '/gifts') ? 'active' : ''}">
                                    <i class="bi bi-gift"></i>
                                    <span>Qu√† t·∫∑ng</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/occasions" class="nav-link" th:classappend="${#strings.startsWith(currentPath, '/occasions') ? 'active' : ''}">
                                    <i class="bi bi-calendar-event"></i>
                                    <span>D·ªãp ƒë·∫∑c bi·ªát</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/blog" class="nav-link" th:classappend="${#strings.startsWith(currentPath, '/blog') ? 'active' : ''}">
                                    <i class="bi bi-journal-text"></i>
                                    <span>Blog</span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/contact" class="nav-link" th:classappend="${currentPath == '/contact' ? 'active' : ''}">
                                    <i class="bi bi-telephone"></i>
                                    <span>Li√™n h·ªá</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>

                <!-- Actions Section -->
                <div class="actions-section">
                    <!-- Wishlist -->
                    <a href="/wishlist" class="action-btn" title="Danh s√°ch y√™u th√≠ch" th:if="${isUserAuthenticated}">
                        <i class="bi bi-heart"></i>
                        <span class="action-badge" th:if="${wishlistCount > 0}" th:text="${wishlistCount}">0</span>
                    </a>

                    <!-- Shopping Cart -->
                    <a href="/cart" class="action-btn" title="Gi·ªè h√†ng" th:if="${isUserAuthenticated}">
                        <i class="bi bi-bag"></i>
                        <span class="action-badge" th:if="${cartCount > 0}" th:text="${cartCount}">0</span>
                    </a>

                    <!-- Mobile Menu Toggle -->
                    <button class="mobile-menu-btn d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileMenu">
                        <span class="hamburger-line"></span>
                        <span class="hamburger-line"></span>
                        <span class="hamburger-line"></span>
                    </button>
                </div>
            </div>

            <!-- Mobile Search -->
            <div class="mobile-search d-lg-none">
                <form class="search-form" action="/search" method="GET">
                    <div class="search-input-group">
                        <i class="bi bi-search search-icon"></i>
                        <input type="text" 
                               class="search-input" 
                               name="q" 
                               placeholder="T√¨m ki·∫øm hoa..."
                               th:value="${searchQuery}">
                        <button type="submit" class="search-btn">
                            <i class="bi bi-search"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </header>
</div>

<!-- Mobile Offcanvas Menu -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="mobileMenu">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title">
            StarShop <span class="heartbeat">üå∏</span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
        <!-- User Section for Mobile -->
        <div class="mobile-user-section" th:if="${isUserAuthenticated}">
            <div class="user-info">
                <img th:if="${userObject != null and userObject.avatar != null}" 
                     th:src="${userObject.avatar}" 
                     alt="Avatar" 
                     style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; margin-right: 12px;"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='inline-block';">
                <i th:if="${userObject == null or userObject.avatar == null}" class="bi bi-person-circle" style="display: inline-block;"></i>
                <i class="bi bi-person-circle" style="display: none;"></i>
                <span th:text="${userObject != null ? userObject.fullName : currentUser}">User</span>
            </div>
            <hr>
        </div>

        <!-- Mobile Navigation -->
        <ul class="mobile-nav">
            <li><a href="/" class="mobile-nav-link">
                <i class="bi bi-house"></i> Trang ch·ªß
            </a></li>
            <li>
                <a href="#" class="mobile-nav-link mobile-dropdown-toggle">
                    <i class="bi bi-grid"></i> Danh m·ª•c hoa
                    <i class="bi bi-chevron-down"></i>
                </a>
                <ul class="mobile-submenu">
                    <li><a href="/categories/sinh-nhat">Hoa sinh nh·∫≠t</a></li>
                    <li><a href="/categories/tinh-yeu">Hoa t√¨nh y√™u</a></li>
                    <li><a href="/categories/cuoi">Hoa c∆∞·ªõi</a></li>
                    <li><a href="/categories/khai-truong">Hoa khai tr∆∞∆°ng</a></li>
                    <li><a href="/categories/chia-buon">Hoa chia bu·ªìn</a></li>
                    <li><a href="/categories/tang-me">Hoa t·∫∑ng m·∫π</a></li>
                </ul>
            </li>
            <li><a href="/products" class="mobile-nav-link">
                <i class="bi bi-flower2"></i> S·∫£n ph·∫©m
            </a></li>
            <li><a href="/gifts" class="mobile-nav-link">
                <i class="bi bi-gift"></i> Qu√† t·∫∑ng
            </a></li>
            <li><a href="/occasions" class="mobile-nav-link">
                <i class="bi bi-calendar-event"></i> D·ªãp ƒë·∫∑c bi·ªát
            </a></li>
            <li><a href="/blog" class="mobile-nav-link">
                <i class="bi bi-journal-text"></i> Blog
            </a></li>
            <li><a href="/contact" class="mobile-nav-link">
                <i class="bi bi-telephone"></i> Li√™n h·ªá
            </a></li>
        </ul>

        <!-- Mobile Language Switcher -->
        <div class="mobile-language-section">
            <hr>
            <div class="mobile-section-title">
                <i class="bi bi-globe"></i> Ng√¥n ng·ªØ
            </div>
            <div class="mobile-language-options">
                <a href="#" class="mobile-language-option active" data-lang="vi">
                    <img src="https://flagcdn.com/w20/vn.png" alt="Ti·∫øng Vi·ªát" class="flag-icon">
                    Ti·∫øng Vi·ªát
                </a>
                <a href="#" class="mobile-language-option" data-lang="en">
                    <img src="https://flagcdn.com/w20/us.png" alt="English" class="flag-icon">
                    English
                </a>
            </div>
        </div>

        <!-- Mobile Auth Links -->
        <div class="mobile-auth" th:if="${!isUserAuthenticated}">
            <hr>
            <a href="/login" class="btn btn-outline-primary w-100 mb-2">
                <i class="bi bi-box-arrow-in-right"></i> ƒêƒÉng nh·∫≠p
            </a>
            <a href="/register" class="btn btn-primary w-100 mb-2">
                <i class="bi bi-box-arrow-in-right"></i> ƒêƒÉng k√Ω
            </a>
        </div>

        <!-- Mobile User Actions -->
        <div class="mobile-user-actions" th:if="${isUserAuthenticated}">
            <hr>
            <a href="/account/profile" class="mobile-nav-link">
                <i class="bi bi-person"></i> Th√¥ng tin c√° nh√¢n
            </a>
            <a href="/account/orders" class="mobile-nav-link">
                <i class="bi bi-bag"></i> ƒê∆°n h√†ng c·ªßa t√¥i
            </a>
            <a href="/wishlist" class="mobile-nav-link">
                <i class="bi bi-heart"></i> Danh s√°ch y√™u th√≠ch
            </a>
            <a href="/logout" class="mobile-nav-link text-danger" onclick="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')">
                <i class="bi bi-box-arrow-right"></i> ƒêƒÉng xu·∫•t
            </a>
{{ ... }}
    </div>
</div>

</body>
</html>

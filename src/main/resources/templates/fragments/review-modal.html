<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!-- Review Modal Fragment -->
<div th:fragment="review-modal" id="reviewModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-hidden transform transition-all duration-300 scale-95 opacity-0" id="reviewModalContent">
        
        <!-- Modal Header -->
        <div class="bg-gradient-to-r from-pink-500 to-purple-600 px-6 py-4 text-white">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-bold">Đánh giá sản phẩm</h3>
                        <p class="text-white/80 text-sm" id="reviewProductName">Tên sản phẩm</p>
                    </div>
                </div>
                <button onclick="closeReviewModal()" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center hover:bg-white/30 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Modal Body -->
        <div class="p-6 space-y-6">
            
            <!-- Star Rating Section -->
            <div class="text-center">
                <p class="text-gray-700 font-medium mb-4">Bạn cảm thấy sản phẩm này như thế nào?</p>
                <div class="flex justify-center gap-2 mb-2" id="starRating">
                    <button class="star-btn text-4xl text-gray-300 hover:text-yellow-400 transition-colors duration-200" data-rating="1">⭐</button>
                    <button class="star-btn text-4xl text-gray-300 hover:text-yellow-400 transition-colors duration-200" data-rating="2">⭐</button>
                    <button class="star-btn text-4xl text-gray-300 hover:text-yellow-400 transition-colors duration-200" data-rating="3">⭐</button>
                    <button class="star-btn text-4xl text-gray-300 hover:text-yellow-400 transition-colors duration-200" data-rating="4">⭐</button>
                    <button class="star-btn text-4xl text-gray-300 hover:text-yellow-400 transition-colors duration-200" data-rating="5">⭐</button>
                </div>
                <p class="text-sm text-gray-500" id="ratingText">Chọn số sao để đánh giá</p>
            </div>

            <!-- Comment Section -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    Chia sẻ trải nghiệm của bạn <span class="text-gray-400">(không bắt buộc)</span>
                </label>
                <textarea 
                    id="reviewComment" 
                    rows="4" 
                    class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-transparent resize-none transition-all duration-200"
                    placeholder="Hãy chia sẻ cảm nhận của bạn về sản phẩm này. Đánh giá của bạn sẽ giúp những khách hàng khác có thêm thông tin tham khảo..."
                    maxlength="1000"></textarea>
                <div class="flex justify-between items-center mt-2">
                    <span class="text-xs text-gray-400">Tối đa 1000 ký tự</span>
                    <span class="text-xs text-gray-500" id="commentCounter">0/1000</span>
                </div>
            </div>

            <!-- Error Message -->
            <div id="reviewError" class="hidden bg-red-50 border border-red-200 rounded-xl p-4">
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5 text-red-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <p class="text-sm text-red-700" id="reviewErrorText">Có lỗi xảy ra</p>
                </div>
            </div>
        </div>

        <!-- Modal Footer -->
        <div class="px-6 py-4 bg-gray-50 border-t border-gray-100 flex gap-3">
            <button 
                onclick="closeReviewModal()" 
                class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors duration-200">
                Hủy
            </button>
            <button 
                id="submitReviewBtn" 
                onclick="submitReview()" 
                class="flex-1 px-4 py-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white rounded-xl font-medium hover:from-pink-600 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed">
                <span id="submitReviewText">Gửi đánh giá</span>
            </button>
        </div>
    </div>
</div>

<!-- Review Display Fragment -->
<div th:fragment="review-display" class="review-display">
    <!-- Reviews Summary -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-6">
        <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-bold text-gray-900">Đánh giá sản phẩm</h3>
            <div class="text-right">
                <div class="flex items-center gap-2 mb-1">
                    <div class="flex text-yellow-400" id="averageStars">
                        <!-- Stars will be populated by JavaScript -->
                    </div>
                    <span class="text-2xl font-bold text-gray-900" id="averageRating">0.0</span>
                </div>
                <p class="text-sm text-gray-500">
                    <span id="totalReviews">0</span> đánh giá
                </p>
            </div>
        </div>

        <!-- Star Distribution -->
        <div class="space-y-2" id="starDistribution">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <!-- Reviews List -->
    <div class="space-y-4" id="reviewsList">
        <!-- Reviews will be populated by JavaScript -->
    </div>

    <!-- Load More Button -->
    <div class="text-center mt-6">
        <button 
            id="loadMoreReviews" 
            class="px-6 py-3 border border-gray-300 text-gray-700 rounded-xl font-medium hover:bg-gray-50 transition-colors duration-200 hidden">
            Xem thêm đánh giá
        </button>
    </div>
</div>

<!-- Single Review Item Template -->
<div th:fragment="review-item" class="review-item bg-white rounded-xl border border-gray-100 p-6 hover:shadow-sm transition-shadow duration-200">
    <div class="flex items-start gap-4">
        <!-- User Avatar -->
        <div class="w-12 h-12 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full flex items-center justify-center text-white font-semibold text-lg flex-shrink-0">
            <!-- Will show user initial or avatar -->
        </div>
        
        <!-- Review Content -->
        <div class="flex-1 min-w-0">
            <!-- User Info & Rating -->
            <div class="flex items-center justify-between mb-2">
                <div>
                    <h4 class="font-semibold text-gray-900 text-sm">Tên người dùng</h4>
                    <div class="flex items-center gap-2 mt-1">
                        <div class="flex text-yellow-400 text-sm">
                            <!-- Stars -->
                        </div>
                        <span class="text-xs text-gray-500">2 ngày trước</span>
                    </div>
                </div>
                <!-- Edit/Delete buttons for own reviews -->
                <div class="flex gap-2">
                    <!-- Will be populated if user can edit -->
                </div>
            </div>
            
            <!-- Review Comment -->
            <p class="text-gray-700 text-sm leading-relaxed">
                <!-- Comment text -->
            </p>
        </div>
    </div>
</div>

</html>
